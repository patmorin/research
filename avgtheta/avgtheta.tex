\documentclass{patmorin}
\usepackage{amsthm,amsmath,graphicx,stmaryrd}
\usepackage{pat}

\DeclareMathOperator{\erf}{erf}
\DeclareMathOperator{\area}{area}
\newcommand{\eps}{\varepsilon}

\title{\MakeUppercase{On the Average Number of Edges in a Theta Graph}}
\author{Pat Morin,\thanks{School of Computer Science, Carleton University}\,\,
         and Sander Verdonschot\footnotemark[1]}



\begin{document}
\maketitle

\begin{abstract}
  The abstract goes here.
\end{abstract}

\section{Introduction}

Theta graphs, introduced by Keil \cite{A} and, independently by So and
So \cite{} are an important geometric structure that has applications
in networking \cite{A} and data structures.  For a point set, $S$, and
a positive integer, $k$, the $\theta_k$-graph, $\theta_k(S)$, of $S$
is an undirected geometric graph whose vertices are the points of $S$.
The edges of $\theta_k(S)$ are defined as ...

Theta graphs have two important properties that make them suited for
a wide variety of applications:  They are \emph{sparse}; $\theta_k(S)$
has at most $k|S|$ edges.  They are \emph{spanners}; the length of the
shortest path between any two vertices $u$ and $w$ is at most a constant
(dependant only on $k$ and not on $S$) times the Euclidean distance
between $u$ and $w$.  Keil \cite{kXX} showed that $\theta_k(S)$ is a
spanner for any $k\ge 7$, Bonichon \etal\ showed that $\theta_6(S)$
is a spanner,  Bose \etal\ showed that $\theta_5(S)$ is a spanner,
and Bose \etal\ \cite{bXX} showed that $\theta_4(S)$ is a spanner.
In contrast, it is easy to show that $\theta_k(S)$ is not necessarily
a spanner for $k\in\{1,2,3\}$.

Note that, although $\theta_k(S)$ has at most $k|S|$ edges, it can also
have significantly fewer edges.  For example, if the points of $S$ all
lie on a line, then $\theta_k(S)$ has only $|S|-1$ edges.  More typical,
though, is for $\theta_k(S)$ to have somewhere between $k|S|/2$ and $k|S|$
edges;  each vertex $u\in S$ chooses $k$ edges\footnote{Every vertex in
$S$ creates $k$ edges unless it is near the ``boundary'' of the point set.
More precisely, only the points on the $(2\pi/k)$-hull \cite{alpha-hull}
of $S$ may create fewer than $k$ edges.} of the graph but sometimes an
edge $uw$ is created both by $u$ and $w$.

\subsection{The Model and Results}

In this paper, we study the typical number of edges in a $\theta_k$-graph
by studying the average number of edges in the $\theta_k$-graph in 
two different models of random point sets.

We begin by studying (the infinite) $\theta$-graphs generate by a
homogeneous Poisson point process with unit intensity over the entire
Euclidean plane.  In this model, we study the average degree of a vertex
in the $\theta$-graph.  For the $\theta_k$-graph, this quantity is at
most $2k$ since each vertex defines $k$ edges of the graph and each edge
has 2 endpoints.  However, in some cases an edge $uw$ is \emph{mutual}
in the sense that the edge is created both by $u$ and by $w$.  If we
let $p_k$ denote the probability that an edge of the $\theta_k$ graph
is is mutual, then the average degree of the $\theta_k$ graph is
\[
    d_k = (2-p_k)k \enspace .
\]
(The second term corrects for the double-counting of mutual edges.)  Thus,
understanding the average degree of a $\theta_k$-graph boils down to
computing $p_k$.

In \secref{even} we show that, for all even integers $k\ge 4$,
\[
    p_k=\frac{\pi\sqrt{3}}{9}\approx 0.6045997883 \enspace .
\]
That is, the probability of an edge being mutual is independent of
$k$. Thus, for all even integers $k\ge 4$, the average degree of a
vertex is
\[
  d_k = \left(2-\frac{\pi\sqrt{3}}{9}\right)k \approx 1.395400212\cdot k \enspace .
\]

In \secref{odd} we show that, for odd values of $k\ge 5$, the situation
is very different.  The mutual edge probability $p_k$ depends on
$k$ in a complicated way that includes trigonometric functions and
square roots.  However, the value of $p_k$ is significantly larger than
$\frac{\pi\sqrt{3}}{9}$ for all odd values of $k$.  Indeed, $p_k$ is a
decreasing function of $k$ and
\[
  p_k\ge \lim_{k\to\infty} p_k = 2\arctan(1/3)\approx 0.6435011088 \enspace .
\]
Thus, for all odd values of $k\ge 5$,
\[
   d_k \le (2-2\arctan(1/3))k \approx 1.356498891 k
\]
Thus, in some sense, odd values of $k$ offer ''more bang for the buck.''

We also study the \emph{i.u.d.\ model}, in which a set, $S$, of $n$
points is independently and uniformly distributed in a square.  In this
model we show that essentially the same bounds hold.  Specifically,
If $m_k$ is the number of edges of $\theta_k(S)$, then
\[
    \E[m_k] \in nd_k/2\pm O(k\sqrt{n\log n}) \enspace \enspace ,
\]
where $d_k$ is the average degree of the $\theta_k$-graph in the Poisson
model.  We also give a concentration result that shows that the number
of edges, $m_k$, is highly concentrated around its expected value.
In particular
\[
    \Pr\{|m_k - nd_k/2| \ge k\sqrt{cn\log n}\} \le n^{-\Omega(c)} \enspace .
\]

\subsection{Related Work}

A plethora of literature exists on theta graphs \cite{S} and
their applications \cite{S}, though most of this work focuses on
worst-case analysis.  One notable exception is the work of Devroye \etal\
\cite{dgmXX} who study the maximum degree of theta graphs and show that,
if $S$ is a set of $n$ points independently and uniformly distributed in a
certain unit square, then $\theta_k(S)$ has maximum degree concentrated
around $\Theta((\log n)/\log\log n)$.  In the Poisson model, their
result implies that, if we fix a $\sqrt{n}\times\sqrt{n}$ square and
look at the maximum degree of all vertices contained in this square,
then this value is concentrated around $\Theta((\log n)/\log\log n)$.

More references to probabilistic analysis of spanners.

\section{The Poisson Model}

In the Poisson model, the number of points in any region whose
area is $A$ follows a Poisson distribution with parameter $A$.  For
definitions of Poisson processes and distributions see, for example,
Ross \cite[Chapter~2]{ross:introduction}.  For our purposes, the most
important properties of the Poisson process are the following:
\begin{enumerate}
\item The probability  that a particular region $X$ whose area is $A$
   is empty of points is exactly $e^{-A}$.
\item For two disjoint regions $X$ and $Y$, the events ``$X$ is empty
   of points'' and ``$Y$ is empty of points'' are independent.
\end{enumerate}
Our analysis is split into two cases, depending upon whether $k$ is even
or odd.


\subsection{Analysis of $p_k$ for Even $k$}
\seclabel{even}

In this section we determine the value of $p_k$ for even values of $k$.
Surprisingly, the value of $p_k$ in this case does not depend on $k$.

\begin{lem}\lemlabel{even}
 For even integers $k\ge 4$, $p_k=\frac{\pi\sqrt{3}}{9}\approx 0.6045997883$.
\end{lem}

\begin{proof}
  Let $u$ be an arbitrary vertex in a $\theta_k$ graph and let $w$
  be a vertex that $u$ has chosen as a neighbour in one of its cones,
  $C$ ($w$ is the ``closest'' vertex to $u$ in $C$).  Let $T$ be the
  open isosceles triangle defined by $C$ and a line
  through $w$ that is orthogonal to the axis of $C$. See \figref{mutual}.
  Observe that the location of $w$ is uniformly distributed on the
  edge of $T$ opposite $u$;  if this edge has length $\ell$, then $w$
  partitions it into two pieces of length $r$ and $\ell-r$, where $r$
  is uniformly distributed in $[0,\ell]$.

  \begin{figure}
    \centering{\includegraphics{cone}}
    \caption{The edge $uw$ is mutual if and only if $T'\setminus T$ 
       is empty of points.}
    \figlabel{mutual}
  \end{figure}
 
  Let $T'$ be the triangle obtained by reflecting $T$ through the midpoint
  of the edge $uw$ (so that $w$ is a vertex of $T'$). The edge $uw$ is
  mutual if and only if $T'\setminus T$ contains no points.  The area
  of $T'\setminus T$ is
  \[
     A(T'\setminus T) = c(r^2+(\ell-r)^2)  \enspace ,
  \]
  where $\alpha=\alpha(k)$ depends only on $k$.  We now have enough information
  to compute the probability that the edge $uw$ is mutual conditional
  on $\ell$ and $r$:
  \[
    \Pr\{\mbox{$uw$ is mutual} \mid \ell,r\} = \exp(-\alpha(r^2+(\ell-r)^2))
      \enspace .
  \]
  Since $r$ (conditioned on $\ell$) is uniform over $[0,\ell]$, unconditioning
  $r$ gives
  \begin{align*}
    f(\ell) & \equiv \Pr\{\mbox{$uw$ is mutual} \mid \ell\} \\
     & = \int_0^\ell (1/\ell)\exp(-\alpha(r^2+(\ell-r)^2))\,\mathrm{d}r \\
     & = \frac{\sqrt{\pi}}{\ell\sqrt{2\alpha}}
            \cdot\exp(-\alpha\ell^2/2)
            \cdot\erf(\ell\sqrt{\alpha/2})  \enspace ,
%     & = \sqrt{\frac{2\pi}{\sqrt{3}}}\exp(-\sqrt{3}\ell^2/8)
%         \cdot\erf(\sqrt[4]{3}\sqrt{2}\ell/4) \enspace ,
  \end{align*}
  where 
  \[ \erf(x)=\frac{2}{\sqrt{\pi}}\int_0^x e^{-z^2}\,\mathrm{d}z \]
  is the \emph{Gauss error function} \cite{gauss-error}.  

  Next, we remove the conditioning on $\ell$.  The triangle $T$ defines a
  region of area $\alpha\ell^2$ that is empty of points.  Therefore,
  by Property~1 of the Poisson process, the cumulative distribution
  function of $\ell$ is given by
  \[
    P(x) \equiv \Pr\{\ell \le x\} = 1-\exp(-\alpha x^2) \enspace .
  \]
  The probability density function of $\ell$ is therefore given by 
  \[
     p(x) \equiv \frac{d}{dx}P(x) =
     2\alpha x\cdot\exp(-\alpha x^2) \enspace .
  \]
  Finally, we obtain $p_k$ as 
  \begin{align*}
     p_k = \int_0^\infty p(\ell)\cdot f(\ell)\,\mathrm{d}\ell 
     = \frac{\pi\sqrt{3}}{9}
      \approx 0.6045997883  \enspace . & \qedhere
  \end{align*}
\end{proof}

%Thus, for even $k$, the average degree of the $\theta_k$-graph is 
%\[ d_k = \left(2-\frac{\pi\sqrt{3}}{9}\right)k \approx 1.395400212\cdot k \enspace . \]

\subsection{Analysis of $p_k$ for Odd $k$}
\seclabel{odd}

Next, we determine the value of $p_k$ for odd values of
$k\ge 5$.  Although the strategy for doing this is the same as the even
case, the odd case turns out to be considerably more complicated, and
we rely heavily on computer math systems for our calculations.

For the odd case the value of $p_k$ does, indeed depend on $k$.

\begin{lem}\lemlabel{odd}
  For odd $k\ge 5$,
\[
p_k = 
2
\left(\begin{array}{l}
  \arctan\left(
     2\left(\cos\left(\frac{\pi }{k}\right)
       +\cos\left(\frac{3 \pi }{k}\right)\right)^2 / (\alpha\beta) 
  \right) \\
   + \arctan\left(
       4 \left(2 \cos\left(\frac{2 \pi }{k}\right)
       +\sin\left(\frac{2 \pi }{k}\right)^2\right)/(\alpha\beta) 
     \right)
  \end{array}
\right)
%\\
\cot\left(\frac{\pi }{k}\right) 
\beta
%\right)
/
\left(\gamma \alpha\right)\enspace ,
\]
where
\[
\gamma =4+11 \cos\left(\frac{2 \pi }{k}\right)+\cos\left(\frac{6 \pi }{k}\right) \enspace ,
\]
\[
\alpha = 
\sqrt{\frac{\left(27 \cos\left(\frac{\pi }{k}\right)+17 \cos\left(\frac{3 \pi }{k}\right)+3 \cos\left(\frac{5 \pi }{k}\right)+\cos\left(\frac{7 \pi }{k}\right)\right) \csc\left(\frac{\pi }{k}\right)}{\gamma}} \enspace ,
\]
and
\[
\beta = \sqrt{\left(18 \sin\left(\frac{2 \pi }{k}\right)+18 \sin\left(\frac{4 \pi }{k}\right)+11 \sin\left(\frac{6 \pi }{k}\right)+\sin\left(\frac{8 \pi }{k}\right)+\sin\left(\frac{10 \pi }{k}\right)\right)} \enspace .
\]
\end{lem}

\begin{proof}
  The proof proceeds in the same manner as the proof of \lemref{even}.
  Let $u$ be an arbitrary vertex in a $\theta_k$ graph and let $w$ be
  a vertex that $u$ has chosen as a neighbour in one of its cones, $C$.
  Let $T$ be the open isosceles triangle defined by $C$ and a line through
  $w$ that is orthogonal to the axis of $C$. See \figref{mutual-odd}.
  Assume that the side of $T$ opposite $u$ has length $2\ell$.  Using a
  suitable rotation, we may assume that the axis of $C$ is horizontal and,
  by symmetry, we may assume that $w$ is on or above the axis of $C$.
 
  \begin{figure}
    \includegraphics{calcs}
    \caption{The derivation of the $\Pr\{\mbox{$uw$ is mutual}\mid \ell,r\}$
             for odd $k$.}
    \figlabel{mutual-odd}
  \end{figure}
  Under the preceding assumptions, $w$ is then uniformly distributed on
  a vertical segment of length $\ell$ whose endpoints are on the axis
  of $C$ and the upper boundary of $C$.  Suppose that the distance from
  $w$ to the axis of $C$ is $r$.  Then a straightforward, but tedious,
  calculation that mainly uses the law of sines shows that
  \[
      \Pr\{\mbox{$uw$ is mutual}\mid \ell, r\} = \exp(-A-B) \enspace ,
  \]
  where
  \[ 
      A = r^2\left(\frac{\cos(\pi/k)}{2\sin(\pi/k)}+\frac{\sin(\pi/k)}{\cos(\pi/k)}\right)
  \]
  and
  \[
      B = \frac{\left(\frac{\ell\cos(\pi/k)\sin(2\pi/k)}{\sin(3\pi/k)\sin(\pi/k)}-\frac{r\cos(2\pi/k)}{\sin(3\pi/k)}\right)^2\cos(2\pi/k)}{2\cos(\pi/k)}
  \]
  This calculation is illustrated in \figref{mutual-odd} and the
  accompanying worksheet shows the simplifications that lead to the
  expressions for $A$ and $B$.  Integrating over $r$ gives us
  \begin{equation}
    \Pr\{\mbox{$uw$ is mutual}\mid \ell\} = 
      \int_0^\ell (1/\ell)\exp(-A-B)\,\mathrm{d}r . \eqlabel{odd-f}
  \end{equation}
  Like the corresponding integral in the proof of \lemref{even},
  \eqref{odd-f} has a closed-form that includes the Gauss error function.

  In order to remove the conditioning on $\ell$, we need the probability
  density function for $\ell$.  Proceeding as before, we have the
  cumulative distribution function
  \[
     P(x) \equiv \Pr\{\ell\le x\} 
          = 1 - \exp(\ell^2(\sin((\pi-\theta)/2)/\sin(\theta/2))) \enspace ,
  \]
  and the probability density function
  \[
    p(x)\equiv \frac{d}{dx}P(x) = 
     \left(\frac{2x\cos(\pi/k)}{\sin(\pi/k)}\right)
      \exp(x^2\cos(\pi/k)/\sin(\pi/k))
  \]
  Finally, we determine $p_k$ by integrating over $\ell$:
  \[
     p_k = \int_0^\infty p(\ell)\cdot f(\ell)\, \mathrm{d}{\ell} \enspace ,
  \]
  which (after introducing the variables $\alpha$, $\beta$, and $\gamma$)
  yields the expression for $p_k$ given in the statement of the lemma.
\end{proof}

\section{Points in a Unit Square}

Next we argue that results similar to Lemmas~\ref{lem:even} and
\ref{lem:odd}, albeit with lower-order error terms, hold for the
graph $\theta_k(S)$, where $S$ is a set of $n$ points independently
and uniformly distributed in the square $[0,\sqrt{n}]^2$ of area $n$.
Observe that, in this model, the probability that any particular region
of area $A$ contained in $[0,\sqrt{n}]^2$ is empty of points is exactly
$(1-A/n)^n=\exp(-A)-O(1/n)$.  This is consistent with the Poisson model
up to an additive error of $O(1/n)$.

The primary work in this section involves finding values that look like
those in the previous section, but have an additive lower-order error term.
We will use the notation $x= a\pm b$ denotes that $x$ is some value in the interval $[a-b,a+b]$.  We will sometimes encounter expressions like
$A/(1-x)$, with $0<x<1/2$ which we bound by
\[
   A/(1-x) = A+O(A/x) \enspace .
\]
We will also frequently encouter expressions like $(1-A/n)^{n-c}$, where
$c$ is a constant and $A < n/2$.  We will always bound these as follows:
\begin{align*}
   (1-A/n)^{n-c} 
      & = \frac{(1-A/n)^n}{(1-A/n)^c} \\
      & = \frac{\exp(-A)-O(A/n)}{(1-A/n)^c} \\
      & = \frac{\exp(-A)-O(A/n)}{\sum_{i=0}^c \binom{c}{i}(-A/n)^i} \\
      & = \frac{\exp(-A)-O(A/n)}{1-O(A/n)} \\
      & = (\exp(-A)-O(A/n))(1+O(A/n)) \\
      & \ge \exp(-A) - O(A/n) 
\end{align*}
and, similarly, 
\begin{align*}
   (1-A/n)^{n-c} 
      & = \frac{(1-A/n)^n}{(1-A/n)^c} \\
      & \le \frac{\exp(-A)}{(1-A/n)^c} \\
      & = \exp(-A)(1+O(A/n))  \enspace .
\end{align*}


\subsection{Expected Number of Edges}

In this section, we analyze the expected number of edges of $\theta_k(S)$.
For each point $u\in S$ and each $i\in\{1,\ldots,k\}$, let $e(u,i)$ be
the edge (if any) that $u$ creates in its $i$th cone.  We partition
$[0,\sqrt{n}]^2$ into a a \emph{core}, $C=[2t,\sqrt{n}-2t]^2$,
where $t=\sqrt{ck\log n}$, and a \emph{near-boundary},
$\bar{C}=[0,\sqrt{n}]^2\setminus C$ (see \figref{empty}).

\begin{figure}
  \begin{center}
    \includegraphics{empty}
  \end{center}
  \caption{The support, $[0,\sqrt{n}]^2$, is partitioned into a core, $C$,
    and a near-boundary $\bar{C}$.  A point $u$ in the core almost surely
    has a neighbour in every cone, otherwise $u$ is incident on large
    triangle, $T\subset [0,\sqrt{n}]^2$, that is empty of points.}
  \figlabel{empty}
\end{figure}

The motivation for partitioning into a core and near-boundary is that
points in the core behave almost exactly like points in the Poisson model.
The following Lemma shows, for example, that points in the core always
have a neighbour in each of their cones.

\newcommand{\eui}{\mathcal{E}_{u,i}}

\begin{lem}\lemlabel{exists}
  For any $u\in S$ and any $i\in\{1,\ldots,k\}$, let $\eui$ denote
  the event ``$e(u,i)$ exists.''  Then $\Pr\{\eui\mid u\in C\} \ge
  1-n^{-\Omega(c)}$.
\end{lem}

\begin{proof}
  Fix some location of $u\in C$ and draw an open isosceles triangle,
  $T$, with apex $u$, whose internal angle at $u$ is $\theta=2\pi/k$
  and whose height is $t$ (see \figref{empty}).  Observe that, since $u$
  is in the core, $T\subset [0,\sqrt{n}]^2$.  Furthermore, the area of $T$
  is 
  \[ 
     A = t^2\sin(\theta/2)/\sin((\pi-\theta)/2)\in \Theta(t^2/k) \enspace .
  \]
  Thus, we immediately have
  \begin{align*}
    \Pr\{T\cap S=\emptyset\mid u\in C\} 
       & = (1-A/n)^{n-1} \\
       & \le \exp(-A)(1+O(A/n)) \\
       & \le 2\exp(-A) & \text{(for sufficiently large $n$)}\\
       & = 2\exp(-\Omega(c\log n)) \\
       & \in n^{-\Omega(c)} \enspace .
  \end{align*}
  If $\eui$ does not occur, this means that $u$'s $i$th $\theta$-cone
  is empty. In particular, this cone contains a triangle like the one
  described above. Therefore, $\Pr\{\eui\mid u\in C\}\le n^{-\Omega(c)}$, as required.
\end{proof}

\newcommand{\mui}{\mathcal{M}_{u,i}}
Let $\mui$ denote the event ``$e(u,i)$ exists and is mutual.''

\begin{lem}\lemlabel{pk}
    $\Pr\{\mui\mid u\in C\} = p_k\pm O(t^3/n)$.
\end{lem}

\begin{proof}
Throughout this proof, all probabilities we compute are conditional
on $u\in C$.
The proof is basically a reproving of Lemmas~\ref{lem:even} and
\ref{lem:odd} that takes care to deal with boundary effects.  Here,
we will prove the case for even $k$ only.

We first compute the probability conditional on $\eui$ and for fixed
values of $\ell$ and $r$ as described in the proof of \lemref{even}
and illustrated in \figref{mutual}.  We add the further condition that
$\ell\le t$.  The edge $e(u,i)$ is mutual if and only if the remaining
$n-2$ points in $S\setminus\{u,w\}$---which are already conditioned on
not being in $T$---also fall outside of $T'$.  The probability that this
happens is
\begin{align*}
   \Pr\{\mui\mid\eui,\,\ell\le t,\, r\}
        & = \left(\frac{1-\area(T\cup T')/n}{1-\area(T)/n}\right)^{n-2} \\
        & = \left(1-\frac{\area(T\setminus T')/n}{1-\area(T)/n}\right)^{n-2} \\
        & = \left(1-\frac{\alpha(r^2+(\ell-r)^2)/n)}
                       {1-\alpha\ell^2/n}\right)^{n-2} \\
        & = \exp(-\alpha(r^2+(\ell-r)^2)) \pm O(\alpha\ell^2/n) \\
        & = \exp(-\alpha(r^2+(\ell-r)^2)) \pm O(\alpha t^2/n)
\end{align*}
We then remove the conditioning on $r$ by integrating:
\begin{align*}
   \Pr\{\mui\mid\eui,\,\ell\le t\} 
     & = \int_0^\ell(1/\ell)\left(\exp(-\alpha(r^2+(\ell-r)^2)) 
           \pm O(\alpha t^2/n)\right)\,\mathrm{d}r \\
     & = f(\ell) \pm O(\alpha t^2/n) \enspace ,
\end{align*}
where $f(\ell)$ is the same $f(\ell)$ defined in the proof of \lemref{even}.

To finish, we need the distribution function for $\ell$ conditional on $\ell\le t$.  The triangle
$T$ has area $\alpha\ell^2$, so we have 
\begin{align*}
   \Pr\{\ell \le x\mid \eui,\,x\le t\} 
      & = \frac{\Pr\{x\le \ell\mbox{ and } x\le t\}}
               {\Pr\{\eui,\, \ell\le t\}} \\
      & = \frac{\Pr\{x\le \ell\}}
               {\Pr\{\eui,\, \ell\le t\}} \\
      & = \frac{\Pr\{x\le \ell\}}
               {1-n^{-\Omega(c)}} \\
      & = \Pr\{x\le \ell\}(1+O(n^{-\Omega(c)})) \\
      & = (1-\alpha x^2/n)^{n-1}(1+O(n^{-\Omega(c)})) \\
      & = (\exp(-\alpha x^2)\pm O(\alpha x^2/n))(1+O(n^{-\Omega(c)})) \\
      & = \exp(-\alpha x^2)\pm O(\alpha t^2/n) \enspace .
\end{align*}
FIXME: This next bit need stronger justification. From this we learn that 
\begin{align*}
   p(x) & = \frac{d}{dx}\Pr\{\ell \le x\mid \eui, \ell\le t\} \\
        & = 2\alpha x\cdot\exp(-\alpha x^2)\pm O(\alpha t^2/n) \enspace .
\end{align*}
And now we have enough information to finish
\begin{align*}
    \Pr\{\mui \mid u\in C\} 
         & \ge \Pr\{\eui\mid u\in C\}\Pr\{\mui\mid \eui,\, u\in C\} \\
         & \ge (1-n^{-\Omega(c)})\Pr\{\mui\mid \eui,\, u\in C\} \\
         & \ge (1-n^{-\Omega(c)})\int_0^t p(\ell)\cdot(f(\ell)\pm O(\alpha\ell^2/n))\,\mathrm{d}{\ell} \\
        & = \frac{\pi\sqrt{3}}{9} \pm O(t^3/n)
\end{align*}
and
\begin{align*}
    \Pr\{\mui \mid u\in C\} 
         & \le \int_0^t p(\ell)\cdot(f(\ell)\pm O(\alpha\ell^2/n))\,\mathrm{d}{\ell} + O(n^{-c}) \\
       & = \frac{\pi\sqrt{3}}{9} \pm O(t^3/n) \enspace .
\end{align*}
%We will prove this statement for even va
%The key observation is that, with high probability, the edge $e(u,i)$
%exists and has length less than $r$.  Otherwise, $u$ is the apex of an
%isosceles triangle that contains no points of $S$, that is contained in
%$[0,1]^2$, and whose area is $A=\Omega(r^2/k)$.  The probability that
%this occurs is at most
%\begin{align*}
%   (1-A/n)^{n-1} 
%    & = \frac{(1-A/n)^{n}}{1-A/n}
%    & = (1-A/n)^n(1+O(A/n))\le \exp(-A)/(1-A/n) = \exp(\Omega(ck\log n))/(1-A/n) = n^{-\Omega(ck)}/(1-A/n) \enspace .
%\]
%Now, if $e(u,i)$ is less than $r$, then the triangle $T'$ that is
%used to compute $\Pr\{\mbox{$uw$ is mutual}\}$ in the proofs of
%Lemmas~\ref{lem:even} and \ref{lem:odd} is completely contained in
%$[0,1]^2$.  The remainder of the proofs of these two lemmas then goes
%through as is, except that expressions like $\exp(-A-B)$ are replaced
%with $(1-A/n-B/n)^{n-O(1)}=\exp(-A-B)\pm O((A+B)/n)$.  Letting $\ell$
%be the length of $e(u,i)$, we obtain
%\[
%   \Pr\{\mbox{$e(u,i)$ is mutual}\mid \ell\le $e(u,i)$ exists and r\} = p_k\pm O(1/n)
%\]
%Putting this all together, we obtain
%\begin{align*}
%  p_k' & \equiv \Pr\{\mbox{$uw$ is mutual}\} \\
%    & = \Pr\{\ell\le r\}\cdot\Pr\{\mbox{$uw$ is mutual}\mid \ell\le r\}
%       + \Pr\{\ell> r\}\cdot\Pr\{\mbox{$uw$ is mutual}\mid \ell > r\} \\
%    & =  \Pr\{\ell\le r\}\cdot\Pr\{\mbox{$uw$ is mutual}\mid \ell\le r\}
%       \pm n^{-\Omega(c)} \\
%    & =  p_k\pm O(1/n)
%\end{align*}
%provided that $c$ is a sufficiently large constant.
\end{proof}

\begin{lem}
 Let $S$ be a set of $n$ points independently and uniformly distributed
 in $[0,1]^2$.  Then the expected number of edges of $\theta_k(S)$ is 
 $nd_k/2\pm O(\sqrt{nk\log n})$.
\end{lem}

\begin{proof}
  Let $E$ denote the number of (undirected) edges, $D$
  the number of directed edges, and $M$ the number of mutual directed edges
  of $\theta_k(S)$.   Then we have
  \[  
     E = D - M/2 \enspace . 
  \]
  Let $E_C$, $D_C$, and $M_C$ denote the same quantities but only
  counting those edges with at least one endpoint in the core.
  We begin with a lower bound:
  \begin{align*}
   \E[E] & \ge \E[E_C] \\
         & = \E[D_C] - \E[M_C]/2 \\
         & = \sum_{u\in S}\sum_{i=1}^k\Pr\{u\in C\}
              \left(\Pr\{\eui\mid u\in C\}
                - \Pr\{\mui\mid u\in C\}/2 \right) \\
        & = (\sqrt{n}-4t)^2
              \left(\Pr\{\eui\mid u\in C\}
                - \Pr\{\mui\mid u\in C\}/2 \right) \\
        & \ge k(\sqrt{n}-4t)^2
              \left(1-n^{-\Omega(c)} - p_k/2 - o(1)\right) \\
        & \ge (kn - 8r\sqrt{n})
              \left(1-n^{-\Omega(c)} - p_k/2 - o(1)\right) \\
        & = kn(1-p_k/2) - o(kn) \\
        & = nd_k/2 - o(kn)
  \end{align*} 
  For the upper-bound we proceed as follows:
  \begin{align*}
     \E[E] & \le \E[E_C] + \E[k|S\cap\bar{C}|] \\
           & = \E[E_C] + k(4t\sqrt{n}-4t^2) \\
           & \le \E[E_C] + 4k\sqrt{nck\log n} \\
           & \le nd_k/2 + o(kn) + 4k\sqrt{nck\log n} \enspace ,
  \end{align*}
  where the last step follows from a calculation similar to that
  done in the lower-bound.
%  Let  denote the number of directed edges in $\theta_k(S)$ and let
%  $m_m$ denote the number of mutual edges in $\theta_k(S)$.  The
%
%
%
%  For each $u\in S$ and each $i\in\{1,\ldots,k\}$, let $e(u,i)$ be the
%  edge that $u$ creates in its $i$th cone.  The probability that $e(u,i)$
%  is mutual is
%  \begin{align*}
%    \Pr\{\mbox{$e(u,i)$ is mutual}\} 
%      & = \Pr\{u\in C\}\Pr\{\mbox{$e(u,i)$ is mutual} \mid u\in C\} +
%          \Pr\{u\not\in C\}\Pr\{\mbox{$e(u,i)$ is mutual} \mid u\not\in C\} \\
%      &\ge\Pr\{u\in C\}\Pr\{\mbox{$e(u,i)$ is mutual} \mid u\in C\} 
%      & = (1-r/sqrt{n})^2 p'_k 
%  \end{align*}
\end{proof}

\subsection{Concentration}

Next, we show that the number of edges in this model is tightly
concentrated about its expected value.  We begin with the following
result, which follows immediately from Hoeffding's Inequality, and shows
that the number of points in the core is highly concentrated around its
expected value:
\begin{lem}\lemlabel{coresize}
  $\Pr\left\{\left||S\cap C|-(\sqrt{n}-4t)^2\right| \ge \sqrt{ck\log n}\right\}
  \in n^{-\Omega(c)}$.
\end{lem}

To prove our concenration bound, we make use of a versatile concentration
inequality due to McDiarmid \cite{X}:

\begin{thm}[McDiarmid's Inequality]
Let $X_1,\ldots,X_n$ be independent all taking values in the set
$\mathcal{X}$ and let $f:\mathcal{X}^n\mapsto\R$ be a function such that
\[
    |f(x_1,\ldots,x_i,\ldots,x_n) - f(x_1,\ldots,x_i',\ldots,x_n)|
    \le k \enspace ,
\]
for some $c>0$ and all $x_1,\ldots,x_n,x_i'\in \mathcal{X}$
and all $i\in\{1,\ldots,n\}$.
Then, for all $\epsilon > 0$,
\[
    \Pr\{|f(X_1,\ldots,X_n) - \E[f(X_1,\ldots,X_n)]| \ge \epsilon\}
       \le 2\exp(-2\epsilon^2/(nk^2))
\]
\end{thm}

\begin{lem}
 Let $S$ be a set of $n$ points independently and uniformly distributed
 in $[0,\sqrt{n}]^2$ and let $M_k$ denote the number of edges in $\theta_k(S)$.
 Then $\Pr\{|M_k-\E[M_k]| \ge k\sqrt{cn\log n}\} \le e^{-\Omega(c)}$.
\end{lem}

\begin{proof}
Let $Q$ be a set of $k$ points chosen such that, for any point
$u\in[0,\sqrt{n}]^2$, each of $u$'s $\theta_k$-cones contains exactly one
point in $Q$. ($Q$ could be, for example, the vertices of a sufficiently
large regular $k$-gon.)  We begin by studying the $\theta_k(S\cup Q)$.
This graph is somewhat more nicely behaved since each vertex in $S$
defines exactly $k$ directed edges.

For a set $S=\{u_1,\ldots,u_n\}\subset [0,\sqrt{n}]^2$,
let $f(u_1,\ldots,u_n)$ be the function that counts the number of edges
in $\theta_k(S\cup Q)$.  Observe that, for any $u_1,\ldots,u_n,u_i'\in
[0,1]^2$, we have that
\[
   |f(u_1,\ldots,u_i,\ldots,u_n)-f(u_1,\ldots,u_i',\ldots,u_n)| \le k \enspace .
\]
That is, moving $u_i$ to location $u_i'$ can be though of as removing
$u_i$, resulting in the loss of at most non-mutual edges emanating from
$u_i$, followed by adding $u_i'$ resulting in the creation of at most $k$
non-mutual edges emanating from $u_i'$.  Letting $M_k'$ denote the number
of edges in $\Theta_k(S\cup Q)$, we immediately obtain, from McDiarmid's Inequality,
\[
   \Pr\left\{\left|M_k'-\E[M_k']\right| \ge k\sqrt{cn\log n}\right\} 
       \le 2\exp(-2c\log n) 
       \in n^{-\Omega(c)} \enspace .
\]
To extend this result to $M_k$, the number of edges of $\theta_k(S)$,
we study $\Pr\{|M_k' - M_k|\ge k\sqrt{cn\log n}\}$.  If $|M_k' - M_k|\ge
k\sqrt{cn\log n}$ then the number of points of $S$ in the near-boundary
$\bar{C}$ exceeds $\sqrt{cn\log n}$ or $\theta_k(S\cup Q)$ contains
edges that join points in $q$ to points in the core, $C$.

The proof of \lemref{exists} shows that
the probability of the latter event is at most $n^{-\Omega(c)}$,
while \lemref{coresize} shows that the probability of the former event
is at most $n^{-Omega(c/sqrt{k})}$\ldots


\end{proof}





\section{Discussion}
\seclabel{summary}

We have given closed-form expressions for the average degree of $\theta_k$
graphs for all $k\ge 4$.  It is known that $\theta_k$-graphs with
$k=1,2,3$ do not have constant spanning ratios \cite{S}, so the cases
$k\ge 4$ are the most important.

\tabref{values} gives the numerical values of $d_k$, $p_k$, and $d_k/k$,
for $k\in\{4,\ldots,20\}$.  This table shows that odd values of $k$

\section*{Acknowledgement}

The authors of this paper are partly funded by NSERC and CFI.

\bibliographystyle{plain}
\bibliography{template}





\end{document}


