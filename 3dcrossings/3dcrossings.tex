\documentclass[12pt]{article}
\usepackage{e-jc}
\usepackage{amsthm,amsmath,graphicx,stmaryrd,amsopn,url}
\usepackage{pat}
\listfiles
 
\newcommand{\eps}{\varepsilon}
\newcommand{\n}{N}

\title{\bf Crossings in grid drawings}


\author{%
  Vida Dujmovi\'c\\
    \small School of Electrical Engineering and Computer Science\\[-0.8ex]
    \small University of Ottawa\\[-0.8ex]
    \small Ottawa, CANADA \\
    \small\tt vdujmovi@uottawa.ca\\
  \and
  Pat Morin\\
    \small School of Computer Science\\[-0.8ex]
    \small Carleton University\\[-0.8ex]
    \small Ottawa, CANADA \\
    \small\tt morin@scs.carleton.ca\\
  \and
  Adam Sheffer\\
    \small The Blavatnik School of Computer Science\\[-0.8ex]
    \small Tel Aviv University\\[-0.8ex]
    \small Tel Aviv, Israel \\
    \small\tt sheffera@post.tau.ac.il\\
}



\DeclareMathOperator{\crs}{cr}
\DeclareMathOperator{\len}{len}
\DeclareMathOperator{\skp}{skip}
\DeclareMathOperator{\ncs}{ncs}
\DeclareMathOperator{\volume}{vol}

\begin{document}
\maketitle
%\cofeAm{0.7}{0.38}{0}{5.5cm}{4in}

\begin{abstract}
  We prove tight crossing number inequalities for geometric graphs whose
  vertex sets are taken from a $d$-dimensional grid of volume $\n$
  and give applications of these inequalities to counting the number
  of crossing-free geometric graphs that can be drawn on such grids.

  In particular, we show that any geometric graph with $m\geq 8N$
  edges and with vertices on a 3D integer grid of volume $N$, has
  $\Omega((m^2/N)\log(m/N))$ crossings. In $d$-dimensions, with $d\ge 4$,
  this bound becomes $\Omega(m^2/N)$. We provide matching upper bounds
  for all $d$. Finally, for $d\ge 4$ the upper bound implies that the
  maximum number of crossing-free geometric graphs with vertices on some
  $d$-dimensional grid of volume $N$ is $N^{\Theta(N)}$. In 3 dimensions
  it remains open to improve the trivial bounds, namely, the $2^{\Omega(N)}$
  lower bound and the $N^{O(N)}$ upper bound.
\end{abstract}


%\begin{titlepage}
%\tableofcontents
%\end{titlepage}

\section{Introduction}

The study of crossings in drawings of graphs has a long history.
\emph{Euler's Formula} states that the maximum number of edges in an $n$
vertex \emph{planar graph}---one that can be drawn in the plane without
crossings---is $3n-6$.  Using Euler's Formula and careful counting, Ajtai
\etal~\cite{ajtai.chvatal.ea:crossing-free} showed that any plane drawing
of a graph with $n$ vertices and $m\ge 4n$ edges has at least $c m^3/n^2$
crossing pairs of edges, for some constant $c\ge 1/100$.  The same authors
used this to prove their main result: The maximum number of non-crossing
subgraphs of any graph drawn on any fixed set of $n$ points is $2^{O(n)}$.

The lower bound, $cm^3/n^2$, on the number of crossings in a plane
drawing has since become known as ``the \emph{Crossing Lemma}''
or ``the \emph{Crossing Number Inequality}'' and has subsequently found many
other applications.  Sz\'ekely~\cite{szekely:crossing} showed that
this inequality can be used to give very simple proofs of many results
in incidence geometry, including a proof of the Szemer\'edi-Trotter
Theorem on point-line incidences~\cite{szemeredi.trotter:extremal}.
Sz\'ekely's method has since been used for many combinatorial geometry
problems; the most famous of these applications is probably the result
of Dey~\cite{dey:improved} on the maximum number $k$-sets of a point set.

Ajtai \etal's proof of the Crossing Lemma works by summing the number
of crossings in two different ways.  More recently, a proof ``from the
book'' that uses the probabilistic method to obtain a better constant,
$c\ge 1/64$, was discovered by Chazelle, Sharir, and Welzl (See Aigner
and Ziegler~\cite[Chapter~30, Theorem~4]{aigner.ziegler:proofs}).
By pushing the ``from the book'' proof even further, Pach
\etal~\cite{pach.radoicic.ea:improving} improved the constant $c$ to
$c\ge 1024/31827\approx 1/33.1$.  Very recently, Ackerman \cite{ackerman:on},
has improved the constant even further to $c\ge 1/29$.

The main result of Ajtai \etal---that the maximum number
of crossing-free graphs that can be drawn on any point set of
size $n$ is $2^{O(n)}$---has also been the starting point
for many research problems. The original bound, which was
$O(10^{13n})$, has been improved repeatedly to the current record of
$O(187.53^n)$~\cite{sharir.sheffer:counting*1}.  The result has also
been tightened for special classes of crossing-free graphs including
triangulations ($O(30^n)$)~\cite{sharir.sheffer:counting}, spanning
cycles ($O(54.55^n)$) \cite{sharir.sheffer.ea:counting}, perfect
matchings ($O(10.05^n)$)~\cite{sharir.welzl:on}, spanning trees
($O(141.07^n)$)~\cite{hoffmann.sharir.ea:counting}, and forests
($O(160.55^n)$)~\cite{hoffmann.sharir.ea:counting,sharir.sheffer:counting}.
A webpage containing an up-to-date compendium of these types of results
is maintained by the third author \cite{sheffer:numbers}.

\subsection{Geometric Grid Graphs}

%Thus motivated by the importance of Ajtai \etal's results, 
The goal of the present paper is to extend the results of Ajtai \etal\
to graph drawings in higher dimensions.  In particular, we extend
their results to graphs drawn on grids.  For any positive integers
$X_1,\ldots,X_d$, the $d$-dimensional \emph{$X_1\times\cdots\times X_d$
grid} is a finite subset of the $d$-dimensional natural lattice, $\N^d$,
given by
\[  \N(X_1,\ldots,X_d) = \{(x_1,\ldots,x_d): 
      \mbox{$x_i\in\{1,\ldots,X_i\}$ for all $i\in\{1,\ldots,d\}$}\}
	\enspace .\]
The \emph{volume} of the $X_1\times\cdots\times X_d$ grid is
$\prod_{i=1}^d X_i$, i.e,. the number of points in the grid.

A ($d$-D) \emph{geometric (grid) graph}, $G$, is a graph with vertex
set $V(G)\subseteq \N^d$.  Throughout this paper, for two vertices $u$
and $w$ in a geometric graph, $G$, we will use the notation $uw$ to
refer both to the open line segment with endpoints $u$ and $w$ and to
the edge $uw\in E(G)$, if present.    The \emph{volume}, $\volume(G)$,
of $G$ is the volume of the minimal $X_1\times\cdots\times X_d$ grid
that contains $V(G)$.

A geometric grid graph, $G$, is \emph{proper} if, for every edge $uw\in
E(G)$, and every vertex $x\in V(G)$, we have that $x\not\in uw$.  That is,
$G$ is proper if no edge passes through a vertex.  For the remainder
of this paper, the phrase ``geometric grid graph'' and ``grid graph''
should be interpreted as ``proper geometric grid graph.''

Two edges $uw$ and $xy$ in a geometric grid graph \emph{cross} if they have a
point in common.  When this happens, we say that $uw$ and $xy$ form
a \emph{crossing}.  We define $\crs(G)$ as the number of crossings
in $G$.\footnote{Note that this is different from the planar crossing
number, usually also denoted $\mathrm{cr}(G)$, that is the minimum number of
crossings in any drawing of the (non-geometric) graph $G$.  Our definition
is more akin to the crossing number of a drawing of a graph.}
To avoid later confusion, the reader should note that 
$\crs(G)$ counts \emph{pairs} of crossing edges, so that if $k$ edges meeting in 
a common point, then this contributes $\binom{k}{2}$ to the value of $\crs(G)$.
We say that
$G$ is \emph{crossing-free} if $\crs(G)=0$.  Finally, we define
\[ \crs_d(\n,m)=\min\left\{\crs(G):\mbox{%
    $G$ is a $d$-D grid graph, $|E(G)|=m$, and $\volume(G)\le\n$}
%   $V(G)\subseteq\N(x_1,\ldots,x_d)$,
%   $\prod_{i=1}^d x_i\le n$,
%   and $|E(G)|=m$}
   \right\} \enspace .
\]
That is, $\crs_d(\n,m)$ is the minimum number of crossings in any
$d$-D geometric grid graph with $m$ edges and volume no more
than $\n$.

We are also interested in the maximum number, $\ncs_d(\n)$, of crossing-free
$d$-D geometric grid graphs that can be drawn on any particular grid of
volume at most $\n$.  That is,
\[
  \ncs_d(\n) = \max\left\{
     \left|\left\{G:\mbox{$V(G)\subseteq\N(X_1,\ldots,X_d)$
            and $\crs(G)=0$} \right\}\right| :
    \mbox{$\prod_{i=1}^d X_i \le\n$} \right\} \enspace .
\]

Results on plane drawings of graphs have immediate implications
for $\crs_2(\n,m)$ and $\ncs_2(\n)$:
\begin{enumerate}
  \item  Euler's Formula implies that $\crs_2(\n,3\n-5)\ge 1$,
  \item  Ajtai \etal's Crossing Lemma implies that $\crs_2(\n,m)\ge
  cm^3/\n^2$ for $m\ge 4\n$, and
  \item  Ajtai \etal's upper-bound of $2^{O(n)}$ on the number of planar
  graphs that can be drawn on any planar point set of size $n$ implies that
  $\ncs_2(\n)\in 2^{O(\n)}$.
\end{enumerate}

Bose \etal~\cite{bose.czyzowicz.ea:maximum} show that the maximum number
of edges in a crossing-free $d$-D geometric grid graph of volume $\n$ is at
most $(2^d-1)\n-\Theta(\n^{(d-1)/d})$. This result is analogous to Euler's
Formula in the sense that it shows that such graphs have a linear number
of edges.  It also implies, for example, that $\crs_d(\n,(2^d-1)\n)\ge 1$.
Since Euler's Formula is the main property of planar graphs used by Ajtai
\etal\ to prove their results, it seems reasonable that bounds similar
to those of Ajtai \etal\ should hold for $d$-D geometric grid graphs.

The key difference, however, is that unlike Euler's formula, the bound
of Bose \etal\ depends on the volume, $\n$, of the grid and not on the
number, $n$, of vertices in the graph.  For $d\ge 3$ it is not possible
to obtain non-trivial bounds on the number of crossings that depend
only on the number of edges and vertices.  This is because every graph
on $n=N^{1/3}$ vertices can be drawn as a 3-D geometric grid graph of
volume $N$ \cite{cohen.eades.ea:three-dimensional}.
%The underlying reason for this, and the reason the proof techniques used
%to prove the Crossing Lemma do not work, is that a vertex induced subgraph
%of a geometric grid graph whose volume is $N$ does not necessarily have
%volume that is much less than $N$, even if this subraph has only a small
%number of vertices.

\subsection{New Results}

In this paper, we study $\crs_d(\n,m)$ and $\ncs_d(\n)$ for $d\ge
3$ and prove the results shown in \tabref{results}.  In \tabref{results},
and throughout this paper, we assume that $d$ is a constant that is
independent of $\n$ and $m$, so that the $O$, $o$, $\Omega$, $\omega$,
and $\Theta$ notations hide factors that depend only on $d$.
%Throughout this paper
%we use $\ln x$ to denote the natural logarithm of $x$ and $\log x$
%to denote the binary logarithm of $x$.

\begin{table}
  \begin{center}
    \begin{tabular}{r|lllc}
      $d$ & $\crs_d(\n,m)$ & $\ncs_d(\n)$ & References \\ \hline
      % 1 & --- & $2^{\n-1}$ & trivial \\
      2 & $\Theta(m^{3}/\n^2)$ & $2^{\Theta(\n)}$ &~\cite{ajtai.chvatal.ea:crossing-free} \\
      3 & $\Theta((m^2/\n)\log(m/\n))$ &  & Theorems~\ref{thm:3d-lower-bound} and \ref{thm:3d-upper-bound} \\
      $\ge 4$ & $\Theta(m^{2}/\n)$ & $2^{\Theta(\n\log\n)}$ & Theorems~\ref{thm:4d-lower-bound}, \ref{thm:4d-upper-bound}, and \ref{thm:4d-counting} \\
    \end{tabular}
  \end{center}
  \caption{Old and new results on crossings in $d$-D geometric grid graphs.}
  \tablabel{results}
\end{table}

Our results show that the situation in three and higher dimensions
is significantly different than in two dimensions. For all $d \ge
4$, and $m\ge 2^d\n$, $\crs_d(\n,m)\in \Theta(m^2/\n)$ and even
$\crs_3(\n,m)$ is only $\Theta((m^2/\n)\log(m/\n))$.
There are therefore geometric grid graphs with $\Omega(\n^2)$ edges
that have only $O(\n^3)$ crossings ($O(\n^3\log\n)$ crossings in
3-d).  In contrast, in 2 dimensions, any graph with $n$ vertices and
$\Omega(n^2)$ edges has $\Omega(n^4)$ crossings.

For $d\ge 4$, the bounds on $\crs_d(\n,m)$ are strong enough to
show that $\ncs_d(\n)\in 2^{\Theta(\n\log\n)}$.  Thus, the number,
$2^{\Theta(\n\log\n)}$, of crossing-free graphs whose vertex set comes
from a specific $d$-dimensional grid having $\n$ points is much larger
than the number, $2^{\Theta(\n)}$,  of crossing-free graphs that can be
drawn on any planar point set of size $\n$.

\subsection{Related Work}

The study of crossing-free 3-D geometric grid graphs is an
active area in the field of graph drawing.  A \emph{$d$-D
grid drawing} of a graph, $G$, is a
one-to-one mapping $\varphi:V(G)\rightarrow \N^d$.  Any drawing,
$\varphi$, yields a geometric grid graph, $\varphi(G)$, with
vertex set $V(\varphi(G))=\{\varphi(u):u\in V\}$ and edge set
$E(\varphi(G))=\{\varphi(u)\varphi(w):uw\in E(G)\}$.  The drawing
$\varphi$ is \emph{crossing-free} if the geometric grid graph $\varphi(G)$
is crossing-free and the \emph{volume} of $\varphi$ is the volume of
$\varphi(G)$.

Cohen \etal~\cite{cohen.eades.ea:three-dimensional} showed that the
complete graph on $n$ vertices, and therefore any graph on $n$
vertices, has a crossing-free 3-D grid drawing of volume $O(n^3)$ and this
is optimal.  However, for many classes of graphs, sub-cubic volume 3-D
grid drawings are possible; this includes 
sufficiently sparse graphs ($O(m^{4/3}n)$)
  \cite{dujmovic.wood:three-dimensional}, 
  graphs with maximum degree $\Delta$ and other $\Delta$-degenerate
  graphs 
  ($O(\Delta mn)$, $O(\Delta^{15/2}m^{1/2}n$)) 
  \cite{dujmovic.wood:three-dimensional,dujmovic.wood:upward},
$\chi$-colorable graphs 
  ($O(\chi^2n^2)$, $O(\chi^6m^{2/3}n)$)
  \cite{pach.thiele.ea:three-dimensional,dujmovic.wood:three-dimensional}, 
graphs taken from some proper minor-closed family of graphs 
  ($O(n^{3/2})$)
  \cite{dujmovic.wood:three-dimensional}, 
planar graphs ($O(n\log^{16} n)$)
  \cite{battista.frati.ea:on},
outerplanar graphs ($O(n)$)
  \cite{felsner.liotta.ea:straight-line},
and graphs of constant treewidth ($O(n)$) \cite{dujmovic.morin.ea:layout}.  

%A summary of these results is given in \tabref{volume-bounds}.
%
%\newcommand{\Oh}[1]{\ensuremath{O(#1)}}
%\begin{table}[htb]
%  \begin{center}
%    \begin{tabular}{lll}
%      graph family & volume & reference\\ \hline
%      arbitrary & \Oh{n^3} 
%         & Cohen \etal~\cite{cohen.eades.ea:three-dimensional}\\
%      arbitrary & \Oh{m^{4/3}n} 
%         & Dujmovi\'c and Wood~\cite{dujmovic.wood:three-dimensional}\\
%      maximum degree $\Delta$	& \Oh{\Delta mn}
%         & Dujmovi\'c and Wood~\cite{dujmovic.wood:three-dimensional}\\
%      maximum degree $\Delta$	& \Oh{\Delta^{15/2} m^{1/2} n}	
%         & Dujmovi\'c and Wood~\cite{dujmovic.wood:upward}\\
%      $\Delta$-degenerate & \Oh{\Delta mn}
%         & Dujmovi\'c and Wood~\cite{dujmovic.wood:upward}\\
%      $\Delta$-degenerate & \Oh{\Delta^{15/2} m^{1/2} n}
%         & Dujmovi\'c and Wood~\cite{dujmovic.wood:three-dimensional}\\
%      $\chi$-colorable & \Oh{\chi^2n^2}
%         & Pach \etal~\cite{pach.thiele.ea:three-dimensional}\\
%      $\chi$-colorable & \Oh{\chi^6m^{2/3}n}		
%         & Dujmovi\'c and Wood~\cite{dujmovic.wood:three-dimensional}\\
%      proper minor-closed	& \Oh{n^{3/2}}
%         & Dujmovi\'c and Wood~\cite{dujmovic.wood:three-dimensional}\\
%      planar & \Oh{n\log^{16}n}
%         & Battista \etal~\cite{battista.frati.ea:on} \\
%      outerplanar & \Oh{n}			
%         & Felsner \etal~\cite{felsner.liotta.ea:straight-line}\\
%      bounded treewidth & \Oh{n}			
%         & Dujmovi\'c \etal~\cite{dujmovic.morin.ea:layout}\\
%    \end{tabular}
%  \end{center}
%  \caption{Volume of crossing-free $3$-D grid drawings of graphs
%    with $n$ vertices and $m\geq n$ edges.}
%  \tablabel{volume-bounds}
%\end{table}

The work most closely related to the current work, in that it presents
an extremal result relating crossings, volume, and number of edges, is
that of Bose \etal~\cite{bose.czyzowicz.ea:maximum}, who showed that the
maximum number of edges in a crossing-free $d$-D geometric grid graph,
$G$, with vertex set $V(G)\subseteq \N(X_1,\ldots,X_d)$, is exactly
\begin{equation}
    \prod_{i=1}^d (2X_i-1) - \prod_{i=1}^d X_i \enspace . \eqlabel{czyzo}
\end{equation}
For a fixed volume, $\n=\prod_{i=1}^d X_i$, maximizing \eqref{czyzo} gives
$X_1=\cdots=X_d=\n^{1/d}$, in which case \eqref{czyzo} becomes $(2^d-1)\n -
\Theta(\n^{(d-1)/d})\le (2^d-1)\n$.  We state this here as lemma since we
make use of it several times.
\begin{lem}[Bose \etal\ 2004]\lemlabel{boser}
  In any crossing-free $d$-D geometric grid graph, $G$, of volume $\n$,
  we have that $|E(G)|\le(2^d-1)\n$.
\end{lem}
\lemref{boser} immediately yields the upper-bound
$\ncs_d(\n)\in2^{O(\n\log\n)}$ (see the beginning of \secref{counting}).
It also yields the lower-bound $\crs_d(m)\ge m-(2^{d}-1)N$ since,
if a geometric grid graph $G$ has $m\ge 2^{d-1}N$ edges, then we can
remove an edge from $G$ that eliminates at least one crossing.
Since this can be repeated until $G$ has $m\le 2^{d-1}N$ edges, this
implies that $G$ has at least $m-(2^d-1)N$ crossings.

Finally, we note that Bukh and Hubard \cite{bukh.hubard:space} present a
different definition of crossing number for 3-dimensional geometric graphs
that are not necessarily grid graphs.  In their definition, a 4-tuple
of vertex-disjoint edges forms a \emph{space crossing} if there is
a line that intersects every edge in the 4-tuple.  The \emph{space
crossing number}, $\crs_4(G)$, of a 3-d geometric graph, $G$, is the
number of space crossings formed by $G$'s edges.  They show that a
3-d geometric graph $G$ with $n$ vertices and $m\ge 4^{41}n$ edges
has a space crossing number $\crs_4(G) \in \Omega(m^6/(n^4\log^2 n))$.
An easy lifting argument shows that this bound on the space crossing
number almost implies the Crossing Lemma; specifically, it shows that
the number of crossings in a graph with $n$ vertices and $m$ edges drawn
in the plane is $\Omega(m^3/(n^2\log n))$.

\section{3-Dimensional Geometric Grid Graphs}

In this section, we present upper and lower bounds on $\crs_3(\n,m)$.
Here, and in the remainder of the paper we use the notation
$u_i$, $i\in\{1,\ldots,d\}$, to denote the $i$th coordinate of the
$d$-dimensional point $u$.  Thus, for a point $u\in\R^3$, $u_1$, $u_2$,
and $u_3$ are $u$'s x-, y-, and z-coordinates, respectively.

\subsection{The Lower Bound}
\seclabel{3d-lower-bound}


\begin{thm}\thmlabel{3d-lower-bound}
  For all $m\ge 8\n$, $\crs_3(\n,m) \in \Omega((m^2/\n)\log(m/\n))$.
\end{thm}

\begin{proof}
  Let $G$ be any geometric grid graph with $V(G)\subseteq\N(X,Y,Z)$,
  with $XYZ\le\n$, and $|E(G)|=m$. (That is, $G$ is a 3-D geometric
  grid graph with $m$ edges and volume at most $\n$.)  We may assume,
  without loss of generality, that no edge of $G$ contains any point
  of the $X\times Y\times Z$ grid in its interior; any such edge can
  be replaced with a shorter edge without introducing any additional
  crossings.  This modification may change the underlying graph, but
  does not change $m$ or $\n$, which are the only quantities considered
  in the statement of the theorem. This assumption is subtle,
  but important, and is equivalent to assuming that, for every edge $uw$
  of $G$, $\gcd(u_1-w_1, u_2-w_2, u_3-w_3)=1$.

  For any integer, $p\ge 1$, define the $X\times Y\times Z$
  \emph{$p$-grid} as the set of points
  \[
    \{(x/p,y/p,z/p): x\in\{p,p+1,\ldots,pX\},\,
    y\in\{p,p+1,\ldots,pY\},\, z\in\{p,p+1,\ldots,pZ\}\} \enspace ,
  \]
  which we denote by $\N(pX,pY,pZ)/p$.  Observe that the size of the
  $p$-grid is at most $\n p^3$.

  Notice that the $p$-grid and $q$-grid, for $q\neq p$ are not necessarily
  disjoint since, for example, the 4-grid includes the 2-grid.  We wish
  to count crossings in $G$ by counting the number of crossings that
  occur on the $p$-grid for different values of $p$.  However, in order
  to do this without double-counting any crossings we need a sequence
  of disjoint grids. To obtain these, we define
  the \emph{essential $p$-grid} by starting with the $p$-grid and removing
  the $q$-grid for all $q\in\{1,\ldots,p-1\}$ such that $q$ divides $p$.
  (See \figref{grid}.)
  
  \begin{figure}
    \begin{center}
      \includegraphics{grid}
    \end{center}
    \caption{A 2-dimensional piece of the essential 6-grid.  Removing
     the 1-grid, 2-grid, and 3-grid from the 6-grid leaves the
     essential 6-grid.}
    \figlabel{grid}
  \end{figure}

  Next, observe that each edge $uw$ of $G$ contains the $p$-grid points
  \[
      P_{uw}^p = \{ u+(i/p)(w-u) : i\in\{1,\ldots,p-1\} \} \enspace 
  \]
  including the subset 
  \[
      Q_{uw}^p = \{ u+(i/p)(w-u) : i\in\{1,\ldots,p-1\}\mbox{
         and  }\gcd(i,p)=1 \} \enspace .
  \]
  We shall now argue, using the assumption that $\gcd(u_1-w_1, u_2-w_2,
  u_3-w_3)=1$, that $Q_{uw}^p$ contains only essential $p$-grid points,
  More specifically, the points in $Q_{uw}^p$ are clearly on the $p$-grid,
  so the only concern is that some of these points are on the $q$-grid
  for some $q<p$.  To see why this is not possible, observe that,
  if some point in $Q_{uw}^p$ were on the $q$-grid, for some $q<p$,
  this would imply that
  \[  ((i/p)x,(i/p)y,(i/p)z) = (a/q,b/q,c/q) \]
  for some integers $x=w_1-u_1$, $y=w_2-u_2$, $z=w_3-u_3$, $a$, $b$, and
  $c$ such that $\gcd(i,p)=1$ and $\gcd(x,y,z)=1$. Rewriting this gives
  \begin{equation}
     (x,y,z) = (pa/(iq),pb/(iq),pc/(iq)) \enspace .   \eqlabel{snapper}
  \end{equation}
  Each value on the right hand side has a factor of $p$ in the numerator,
  so they must also have a factor of $p$ in the denominator.
  Otherwise, $\gcd(pa/(iq),pb/(iq),pc/(iq)) > 1 = \gcd(x,y,z)$.  But this
  is not possible since $\gcd(i,p)=1$ and $q<p$, so $\gcd(iq,p)\le q < p$.

  The size of the set $Q_{uw}^p$ is a well-studied quantity and is given
  by the \emph{Euler totient function} $\varphi(p)=p\prod_{q|p}(1-1/q)$,
  where $q$ ranges over all primes that divide $p$
  \cite[Section~5.5]{hardy.wright:introduction}.  Therefore, the total
  number of incidences between points of the essential $p$-grid and
  edges of $G$ is at least $m\cdot\varphi(p)$.  In understanding the
  calculations that follow, it is helpful to pretend that $\varphi(p)\ge
  cp$ for some constant $0<c<1$, though this is not strictly correct
  since, for some $p$, $\varphi(p)\in O(p/\log\log p)$.

  Let $x_1,\ldots,x_\ell$ denote the essential $p$-grid points that are
  incident to at least one edge and let $R_i$, with $i\in\{1,\ldots,\ell\}$,
  denote the number of edges incident to $x_i$.  Observe that
  there are $\binom{R_i}{2}$ crossing pairs of edges that cross at
  $x_i$.  From the preceding discussion, we have $\sum_{i=1}^\ell R_i
  \ge m\cdot\varphi(p)$.  Therefore, the total contribution of crossings that
  occur on the essential $p$-grid to $\crs_3(G)$ is at least
  \[
      \sum_{i=1}^\ell\binom{R_i}{2} \ge \ell \binom{m\cdot\varphi(p)/\ell}{2}
      \in \Omega(\ell (m\cdot\varphi(p)/\ell)^2)
      = \Omega\left(\frac{m^2\varphi(p)^2}{p^3N}\right) \enspace . 
  \]
  The first inequality is an application of Jensen's Inequality
  to the function $f(x)=x(x-1)/2$.  Since $\ell\le \n p^3$,
  $\binom{m\cdot\varphi(p)/\ell}{2}\ge 0$ for $p\le \sqrt[3]{m/\n}$
  and the second inequality holds
   for $p\le \sqrt[3]{m/\n}$.
%  On the other hand, we have the lower-bound $p\ge 2$ since the essential
%  1-grid is empty.  This combines with the preceding conditions to
%  yield the condition $m\ge 12n$.  (Note that the cases $8\n\le m< 12\n$
%  can be dispensed with by the observation, noted after \lemref{boser},
%  that $\crs_3(d) \ge m-7\n$.)

%  that we have
%  \[
%     \Omega((m\cdot\varphi(p))^2/\ell) \ge \Omega(m^2\varphi(p)/(\n p^2)) \ge \Omega(m^2/(\n p\log\log p)) 
%  \]
%  Finally, 
  To finish, we need the following number-theoretic result which follows
  from well-known theorems and whose proof is included, for completeness,
  in \appref{nummer}.
  \begin{clm}\clmlabel{nummer}
     $\sum_{i=1}^k \varphi(i)^2/i^3\in\Omega(\log k)$
  \end{clm}
  
  Finally, we can finish by summing over $p$ and using \clmref{nummer}
  to obtain:
  \begin{align*}
     \crs(G) 
       & \ge \sum_{p=1}^{\lfloor\sqrt[3]{m/\n}\rfloor} 
                \Omega\left(\frac{m^2\varphi(p)^2}{p^3N}\right) \notag \\
       & = \Omega(m^2/\n)\sum_{p=1}^{\lfloor\sqrt[3]{m/\n}\rfloor} 
                 \varphi(p)^2/p^3 \\
             & = \Omega(m^2/\n)\log(m/\n) \enspace ,
  \end{align*}
  as required.
\end{proof}


% This is the old (m^2/\n)loglog(m/\n) lower bound
%\begin{thm}\thmlabel{3d-lower-bound}
%  For all $m\ge 16\n$, $\crs_3(\n,m) \in \Omega((m^2/\n)\log\log (m/\n))$.
%\end{thm}
%
%\begin{proof}
%  Let $G$ be any geometric grid graph with $V(G)\subseteq\N(X,Y,Z)$,
%  with $XYZ\le\n$, and $|E(G)|=m$. (That is, $G$ is a 3-D geometric
%  grid graph with $m$ edges and volume at most $\n$.)  We may assume,
%  without loss of generality, that no edge of $G$ contains any point
%  of the $X\times Y\times Z$ grid in its interior; any such edge can
%  be replaced with a shorter edge without introducing any additional
%  crossings and without changing $m$ or $\n$.
%
%  For a prime number, $p$, define the $X\times Y\times Z$ \emph{$p$-grid}
%  as the set of points
%  \[
%    \{(x/p,y/p,z/p): x\in\{p,p+1,\ldots,pX\},\,
%    y\in\{p,p+1,\ldots,pY\},\, z\in\{p,p+1,\ldots,pZ\}\} \enspace ,
%  \]
%  which we denote by $\N(pX,pY,pZ)/p$.
%  Observe that, for two distinct primes $p$ and $q$, the intersection
%  of the $p$-grid and the $q$-grid is exactly the $X\times Y\times Z$
%  grid. (This is because the only integers $a$ and $b$ that satisfy the
%  equation $a/p = b/q$ have $a\equiv 0 \pmod{p}$ and $b\equiv 0\pmod q$,
%  so $a/p$ and $b/q$ are each integers.)
%
%  Note that the number of points in the $X\times Y\times Z$ $p$-grid is
%  less than $\n p^3$.  Note, furthermore, that each edge $uw$ of $G$
%  contains the $p$-grid points
%  \[
%      P_{uw}^p = \{ u+(i/p)(w-u) : i\in\{1,\ldots,p-1\} \} \enspace .
%  \]
%  Next, we claim that $P_{uw}^p$ does not contain any $q$-grid points for
%  any prime $q\neq p$.  In fact, $P_{uw}^p$ does not contain any point
%  of the $X\times Y\times Z$ grid.  This follows from the assumption that
%  $uw$ contains no grid point in its interior, so $\gcd(u_1-w_1, u_2-w_2,
%  u_3-w_3)=1$.  In particular, at least one of $u_1-w_1$, $u_2-w_2$,
%  or $u_3-w_3$ does not have $p$ as a divisor.  If, say, $w_1-u_1$ does
%  not have $p$ as a divisor then $(i/p)(w_1-u_1)$ is not an integer for
%  any $i\in\{1,\ldots,p-1\}$ and therefore $u+(i/p)(w-u)$ is not on the
%  $X\times Y\times Z$ grid.
%
%  Let $x_1,\ldots,x_\ell$ denote the $p$-grid points that are incident
%  on at least one edge and let $R_i$, $i\in\{1,\ldots,\ell\}$, denote
%  the number of edges incident to $x_i$.  Observe, then, that there
%  are $\binom{R_i}{2}$ crossing pairs of edges that cross at $x_i$.
%  From the preceding discussion, we have $\sum_{i=1}^\ell R_i \ge (p-1)m$
%  and $\ell\le\n p^3$.  Therefore the total contribution of crossings
%  that occur on the $p$-grid to $\crs_3(G)$ is at least
%  \[
%      \sum_{i=1}^\ell\binom{R_i}{2} \ge \ell \binom{m(p-1)/\ell}{2}
%      \ge\n p^3\binom{m(p-1)/(\n p^3)}{2} \ge cm^2/(\n p) \enspace ,
%  \]
%  for $c=2$ and $m(p-1)/(\n p^3) \ge 2$.  This latter condition is satisfied
%  for $p \le \sqrt{m/(4\n)}$. Since $p=2$ is the smallest prime
%  number, the conditions $2\le p\le\sqrt{m/(4\n)}$ yield the
%  condition $m\ge 16\n$ found in the statement of the theorem. Finally,
%  we finish by summing over primes $p$ not exceeding $\sqrt{m/(4\n)}$:
%  \[
%     \crs(G) \ge \sum_{p\le \sqrt{m/(4\n)}} cm^2/(\n p) 
%             = (cm^2/\n) \sum_p 1/p 
%             = (cm^2/\n)(\ln\ln(m/\n)-O(1)) \enspace ,
%  \]
%  where the last equality is Euler's result on the sum of reciprocals
%  of primes. (This sum is also known as a harmonic series of primes.
%  See Hardy and Wright~\cite[Section~22.7]{hardy.wright:introduction}.
%\end{proof}

\subsection{The Upper Bound}
\seclabel{3d-upper-bound}

In this section, we prove the following result:

\begin{thm}\thmlabel{3d-upper-bound}
  For all $m\le\n^2/4$, $\crs_3(\n,m) \in O((m^2/\n)\log (m/\n))$.
\end{thm}

The proof of \thmref{3d-upper-bound} follows easily from the following
lemma:
\begin{lem}\lemlabel{2-layer}
  There exists a 3-D grid drawing of the complete bipartite graph
  $K_{k^2,k^2}$ on the $k\times k\times 2$ grid with $O(k^6\log k)$
  crossings.
\end{lem}

Before proving \lemref{2-layer}, we first show how it implies
\thmref{3d-upper-bound}: For simplicity, in what follows, assume
that each of $\sqrt{\n}$, $\sqrt{m/\n}$, and $\n/\sqrt{m}$ are integers.
Apply \lemref{2-layer}, with $k=\sqrt{m/\n}$ and tile the
$\sqrt{\n}\times\sqrt{\n}\times 2$ grid with $\n/k^2$ copies of
this drawing. The resulting geometric graph has $2\n$ vertices,
$m=\n k^4/k^2=\n k^2$ edges and
\[ 
   O((\n/k^2)k^6\log k) = O(\n k^4\log k) = O((m^2/\n)\log(m/\n))
\] 
crossings, as required by \thmref{3d-upper-bound}.

\begin{proof}[Proof of \lemref{2-layer}]
  The drawing of $K_{k^2,k^2}$ is the obvious one: each point of the
  $k\times k\times2$ grid with z-coordinate 1 is connected by an edge
  to every point with z-coordinate 2.  We denote the resulting
  geometric graph by $G_{k^2}$.

  We start by considering some edge $uw$ with $u_3=1$ (so
  $w_3=2$) and counting the number of edges that intersect $uw$.
  Let $\pi_1,\pi_2,\ldots$ be the planes that contain $uw$ and at least
  one additional vertex of $G$, whose z-coordinate is 1.
  Observe that each such plane, $\pi_j$, contains a line in the plane
  $\{z\in\R^3: z_3=1\}$ and that this line contains $u$ and some vertex,
  $x$ such that $ux$ does not contain any other point of $\Z^3$ i.e.,
  $\gcd(u_1-x_1,u_2-x_2)=1$ (see \figref{planes}).
  \begin{figure}
    \centering{\includegraphics{planes}}
    \caption{A plane $\pi_j$, defined by a point $x$, with
      $\skp(\pi_j)=2$. (z-coordinates are exaggerated.)}
    \figlabel{planes}
  \end{figure}
  Define the \emph{skip} of $\pi_j$ as
  \[
     \skp(\pi_j)=\max\{|u_1-x_1|,|u_2-x_2|\} \enspace .
  \]
  Observe that, if $\skp(\pi_j)=r$, then $\pi_j$ contains at most $2k/r$
  vertices of $G$ other than $u$ and $w$ (at most $k/r$ vertices from
  each ``level'' of $G$) and therefore contains at most $(k/r)^2$
  edges that cross $uw$.  Furthermore, the number of planes $\pi_j$
  such that $\skp(\pi_j)=r$ is at most $4r$ since each such plane is
  defined by two antipodal lattice points on the boundary of a square of
  side length $2r$ centered at $u$; see \figref{skip-count}.  Therefore,
  the total number of edges that cross $uw$ is at most
  \begin{equation}
     \sum_{r=1}^k 4r(k/r)^2 = 4k^2\sum_{r=1}^k 1/r 
       \le 4k^2\ln k + O(k^2) \enspace .
        \eqlabel{critical}
  \end{equation}
  Since this is true for each of the $k^4$ edges, $uw$, we conclude
  that the total number of crossings in $G_{k^2}$ is at most $2k^6\ln
  k+O(k^6)\in O(k^6\log k)$, as required.
  \begin{figure}
    \centering{\includegraphics{skip-count}}
    \caption{Each plane $\pi_j$ with $\skp(\pi_j)=r$ is defined by two
      antipodal lattice points on the boundary of a square of side length
      $2r$ that is centered at $u$.}
    \figlabel{skip-count}
  \end{figure}
\end{proof}

\section{Higher Dimensions}

Next, we prove matching upper and lower bounds on $\crs_d(\n,m)$ for
$d\ge 4$.

\subsection{The Lower Bound}

\begin{thm}\thmlabel{4d-lower-bound}
  For all $m\ge 2^d\n$, $\crs_d(\n,m)\in\Omega(m^2/\n)$.  More specifically,
  $\crs_d(\n,m)\ge \frac{1}{2}(m^2/(2^d-1\n) - m)$, for all $m\ge 0$.
\end{thm}

\begin{proof}
  Let $G$ be any geometric grid graph with $m$ edges whose vertex set is
  contained in the $X_1\times \cdots\times X_d$ grid of volume at most
  $\n$.  As in the proof of \thmref{3d-lower-bound} we may assume, without
  loss of generality, that no edge of $G$ contains a grid point. Observe
  that, for each edge $uw\in E(G)$, the \emph{midpoint} $(u+w)/2$ of $uw$
  is contained in the $X_1\times\cdots\times X_d$ essential 2-grid:
  \[
    \N(2X_1,\ldots,2X_d)/2=\{(x_1,\ldots,x_d)/2:
         \mbox{$x_i \in \{2,3,\ldots,2X_i\}$, 
               $i\in\{1,\ldots,d\}$}\} \setminus \N(X_1,\ldots,X_d)\enspace .
  \]
  This 2-grid contains $K\le (2^d-1)\n$ points. Order the points of
  this 2-grid arbitrarily and let $R_i$ be the number of edges of $G$
  whose midpoint is the $i$th point of this 2-grid. Then the number of
  crossings in $G$ is
  \begin{align*}
   \crs(G) &\ge \sum_{i:R_i\ge 1}\binom{R_i}{2} \\
    & = \frac{1}{2}\left(\sum_{i:R_i\ge 1}(R_i^2-R_i)\right) \\
    & = \frac{1}{2}\left(\sum_{i:R_i\ge 1} R_i^2 - m\right) \\
    & \ge \frac{1}{2}\left(K(m/K)^2 - m\right) & \text{(by Jensen's Inequality)}\\
    & = \frac{1}{2}\left(m^2/K - m\right) \\
    & \ge \frac{1}{2}\left(\frac{m^2}{(2^{d}-1)\n} - m\right) \enspace ,
  \end{align*}
  as required.
%  The proof is similar to the simplified proof of the Crossing
%  Lemma due to Chazelle, Sharir and Welzl~\cite[Chapter~30, Theorem
%  4]{aigner.ziegler:proofs}.  We begin by arguing that the preliminary
%  inequality
%  \begin{equation}
%    \crs_d(\n,m) \ge m - (2^d-1)\n  \eqlabel{prelim}
%  \end{equation}
%  holds for all $m \ge 0$.  To see this, recall that \lemref{boser} states
%  that the maximum number of edges in a crossing-free $d$-D geometric
%  grid graph of volume $n$ is not more than $(2^d-1)\n$.  Therefore,
%  in any such graph with $m> (2^d-1)\n$ edges, we can always remove an
%  edge that eliminates at least one crossing.  This can be repeated
%  $m-(2^d-1)\n$ times, which proves that the number of crossings is at
%  least $m-(2^d-1)\n$.
%
%  Next, let $G$ be any $d$-D geometric grid graph with $m$ edges and
%  volume $n$.  Randomly sample each edge of $G$ independently with
%  probability $p$ to obtain a random subgraph $G'$ of $G$.  The expected
%  number of crossings in $G'$ is then
%  \[  
%     p^2\crs(G) = \E[\crs(G')] \ge pm - (2^d-1)\n \enspace ,
%  \] 
%  where the second inequality follows from the preliminary bound
%  in \eqref{prelim}.  Rewriting this, we obtain
%  \[  
%     \crs(G) \ge m/p - (2^d-1)\n/p^2 \enspace . 
%  \]
%  Setting $p=2(2^{d}-1)\n/m$ yields
%  \[  
%     \crs(G) \ge \frac{m^2}{4(2^{d}-1)\n} \enspace .  \qedhere 
%  \]
\end{proof}

\subsection{The Upper Bound}

\begin{thm}\thmlabel{4d-upper-bound}
  For all $d\ge 4$ and all $m\le\n^2/4$, $\crs_d(\n,m)\in O(m^2/\n)$.
\end{thm}

\begin{proof}
  Let $\ell=k^{d-1}$ for some integer $k$.  As in the proof of
  \thmref{3d-upper-bound}, it suffices to show that one can draw the
  complete bipartite graph $K_{\ell,\ell}$ on the $k\times\cdots\times
  k\times 2$ grid so that it has $O(k^{3(d-1)})=O(\ell^3)$ crossings.
  Briefly, and omitting floors and ceilings: By taking $\ell=m/N$ (so that
  $k=(m/N)^{1/(d-1)}$), we can tile the $N^{1/(d-1)}\times\cdots\times
  N^{1/(d-1)}\times 2$ grid with $\Theta(N/\ell)$ copies of
  $K_{\ell,\ell}$.  The resulting drawing has $\Theta(\ell^2
  N/\ell) = \Theta(\ell N) = \Theta(m)$ edges and $\Theta(\ell^3
  N/\ell)=\Theta(m^2/N)$ crossings.

  The remainder of this proof has the same structure as the proof of
  \lemref{2-layer}.  The drawing of $K_{\ell,\ell}$ we use is the graph
  $G$ with $V(G)=\N(k,\ldots,k,2)$ and
  \[
    \E(G) = \{ uw\in V(G)^2 :\mbox{$u_d = 1$ and $w_d = 2$} \} \enspace .
  \]
  
  Consider some edge $uw$ of $G$ with $u_d=1$ and $w_d=2$.  Our strategy
  is to upper bound the number of edges that cross $uw$.  Any edge $xy$
  that crosses $uw$ is contained in some plane, $\pi$, that contains $uw$
  and $xy$.  Without loss of generality, assume $x_d=1$.  Let $x'$ be some
  point of the integer lattice $\Z^d$ that is on the line containing
  $ux$ and such that $ux'$ contains no point of $\Z^d$. (That is,
  $\gcd(u_1-x'_1,\ldots,u_{d-1}-x'_{d-1}) = 1$.)

  The plane $\pi$ that contains $uw$ and $xy$ can be expressed as
  \[
     \pi = \{ u + t(w-u) + s(x'-u) : s,t\in\R\} \enspace .
  \]
  Restricted to the subspace $S_u=\{z\in\R^d: z_d=1\}$, $\pi$
  becomes a line
  \[
     L_u = \pi\cap S_u = \{ u + s(x'-u) : s\in\R\} \enspace .
  \]
  Similarly, restricted to the subspace $S_w=\{z\in\R^d: z_d=2\}$,
  $\pi$ becomes the parallel line:
  \[
     L_w = \pi\cap S_w = \{ w + s(x'-u) : s\in\R\} \enspace .
  \]
  Observe that, since there is no point on the segment $ux'$, the only
  points of the integer lattice $\Z^d$ contained in $L_u$ are obtained
  when the parameter $s$ is an integer:
  \[
     L_u\cap\Z^d = \{ u + s(x'-u) : s\in\Z\} \enspace 
  \]
  and, similarly,
  \[
     L_w\cap\Z^d = \{ w + s(x'-u) : s\in\Z\} \enspace  .
  \]
  If we define $r=\max\{|x'_i-u_i| : i\in\{1,\ldots,d-1\}\}$, then we see
  that the number of vertices of $G$, other than $u$ and $w$, contained in
  each of $L_u$ and $L_w$ is at most $k/r$ (since $G$'s vertices are
  contained in a box whose longest side has length $k$).  Then,
  we define the \emph{skip} of the plane $\pi$ to be $r$.
  
  Now, consider all the planes that contain $uw$ and some other vertex
  of $G$.  We wish to determine the number of such planes with skip $r$.
  Each such plane is defined by two antipodal grid points on the boundary
  of a $(d-1)$-hypercube of side length $2r$, centered at $u$, that is
  contained in the $(d-1)$-dimensional subspace $\{z\in\R^d:z_d=1\}$.
  This hypercube has $2(d-1)$ facets and each facet contains
  $(2r+1)^{d-2}$ grid points.  Therefore, the total number of planes with
  skip $r$ is at most
  \[
     (d-1)(2r+1)^{d-2} = (d-1)\left((2r)^{d-2} + O(r^{d-3})\right)
  \]
  Each plane with skip $r$ contains at most $(k/r)^2$ edges that cross
  $uw$.  Therefore, the number, $X_{uw}$, of edges that cross $uw$
  is at most
  \begin{align*}
     X_{uw} & \le \sum_{r=1}^k(d-1)\left((2r)^{d-2}+O(r^{d-3})\right)(k/r)^2 \\
         & = (d-1)2^{d-2}k^2\sum_{r=1}^k\left(r^{d-4} + O(r^{d-5})\right) \\
         & \le (d-1)2^{d-2}k^2\left(\frac{k^{d-3}}{d-3} 
             + O\left(k^{d-4}\log k\right)\right) 
               & \text{(since $d\ge 4$)} \\
         & = \frac{(d-1)2^{d-2}k^{d-1}}{d-3} + O(k^{d-2}\log k) \\
         & = O(k^{d-1}) = O(\ell).
  \end{align*}
  Since there are $\ell^2$ edges, the total number of crossings is
  therefore $O(\ell^3)$, as required.
\end{proof}

\section{The Number of Non-Crossing Graphs}
\seclabel{counting}

In this section, we show that, for dimensions $d\ge 4$, $\ncs_d(\n)\in
2^{\Theta(\n\log\n)}$, i.e., the maximum number of crossing-free graphs
that can be drawn on any grid of volume $\n$ is $2^{\Theta(\n\log\n)}$.

The upper bound follows easily from \lemref{boser} which states that
any crossing-free $d$-D geometric grid graph of volume $\n$ has at
most $(2^d-1)\n$ edges.  Therefore, any such graph is a subgraph of a
graph obtained by choosing at most $(2^d-1)\n$ edges from among the at most
$\binom{\n}{2}$ possible edges.  Each graph with $(2^d-1)\n$ edges has
$2^{(2^d-1)\n}$ subsets of edges.  Therefore, the number of such graphs
is at most
\[
  \ncs_d(\n) \le 2^{(2^d-1)\n}\binom{\binom{\n}{2}}{(2^d-1)\n} 
      \le 2^{(2^d-1)\n} (\n^{2})^{(2^d-1)\n} 
      = 2^{2(2^d-1)\n\log\n+(2^d-1)\n} 
      \in 2^{O(\n\log\n)} \enspace .
\]
The preceding argument is standard and is used, for example, by B\'arat
\etal~\cite[Lemma~4]{barat.matousek.ea:bounded-degree} for upper-bounding
the maximum number of crossing-free plane graphs with $m$ edges that can
be drawn on any particular set of $n$ points in the plane.

Next we show that the number of crossing-free geometric graphs that can
be drawn on the $\n^{1/(d-1)}\times \cdots\times\n^{1/(d-1)}\times 2$
grid is at least $2^{\Omega(\n\log\n)}$.

\begin{thm}\thmlabel{4d-counting}
  For all $d\ge 4$, $\ncs_d(\n) \in 2^{\Omega(\n\log\n)}$.
\end{thm}

\begin{proof}
  Let $G_\n$ denote the complete bipartite geometric graph described in
  the proof of \thmref{4d-upper-bound} with the value $\ell=\n/2$ (assuming,
  only for simplicity, that $(\n/2)^{1/(d-1)}$ is an integer).  For a geometric
  graph, $G$, let $\ncs(G)$ denote the number of crossing-free subgraphs
  of $G$ that have the same vertex set as $G$ by with a subset of $G$'s edges.    Observe that $\ncs(G)\ge 1$ since the subgraph obtained by removing all edges
  from $G$ is crossing-free.
  Now define
  \[
     f(m) = \min\{ \ncs(G) : 
                \mbox{$G$ is a subgraph of $G_{\n}$ having $m$ edges} \}
     \enspace . 
  \]
  Our goal is to lower-bound $f(\n^2)$.  In order to do this, we establish
  a recurrence inequality and base cases.
  
  For our base cases, we have 
  \[ 
     f(m)\ge 1 \enspace ,
  \]
  for all $m\ge 0$, since $\ncs(G)\ge 1$ for all graphs, $G$.
  
  Let $c=c(\n)\in O(1)$ be a function such that $c\n$ is an integer and, 
  for all sufficiently large $\n$, every edge of $G_\n$ intersects at most 
  $c\n-1$
  other edges.  By the proof of \thmref{4d-upper-bound} such a function
  $c$ exists.  Fix any subgraph, $G$, of $G_{\n}$ that has $m\ge c\n$ edges.
  From $G$, select any edge $e$. Then there are at least $f(m-1)$
  crossing-free subgraphs of $G$ that do not include $e$.  Furthermore, 
  $e$ intersects
  at most $c\n-1$ other edges of $G$, so there are at least $f(m-c\n)$
  crossing-free subgraphs of $G$ that include $e$.  Therefore,
  \[  
     f(m) \ge f(m-1) + f(m-c\n) \enspace ,
  \]
  for $m\ge c\n$.  Repeatedly expanding the first term gives:
  \begin{align}
  f(m) & \ge  f(m-1) + f(m-c\n) \notag \\
         & \ge  f(m-1) + f(m-2c\n) \notag \\
         & \ge  f(m-2) + 2f(m-2c\n) \notag \\
         & \ge  f(m-3) + 3f(m-2c\n) \notag \\
         & \,\,\,\vdots  \notag \\
         & \ge  c\n\times f(m-2c\n) \enspace , \eqlabel{blech}
  \end{align}
  as long as $m\ge 2c\n$.
  
  For an integer $t$, we can iterate \eqref{blech} $t$ times to obtain
  \begin{equation}
     f(m) \ge (c\n)^t\times f(m-2ct\n) \enspace ,
     \eqlabel{recur-a}
  \end{equation} 
  for $m\ge 2ct\n$.  Taking $m=\n^2$, \eqref{recur-a} becomes
  \[
     f(\n^2) \ge (c\n)^t\times f(\n^2-2ct\n) \ge (c\n)^t \enspace ,
  \]
  for $t \le\n/(2c)$.  Taking $t=\lfloor \n/(2c)\rfloor$ then yields the
  desired result:
  \[
     f(\n^2) \ge (c\n)^{\lfloor\n/(2c)\rfloor} 
            \ge (c\n)^{\n/(2c) - 1} 
            = 2^{(\frac{\n}{2c}-1)(\log\n+\log c)}
            \in 2^{\Omega(\n\log\n)} \enspace . \qedhere
  \]
\end{proof}

We remark that the proof of \thmref{4d-counting} also works to lower-bound
the number of crossing-free matchings in $G_\n$.  When one selects
an edge $uw$ to be part of the matching, the at most $c\n$ edges of
$G_\n$ that intersect $uw$ and the $2\n-1$ edges that have $u$ or $w$
as an endpoint must be discarded.  Thus, one discards at most $(c+2)\n$
edges and the remainder of the proof goes through unmodified.

\begin{cor}\corlabel{matchings}
  For all $d\ge 4$ and $\n=2k^{d-1}$, the number of crossing-free matchings
  with vertex set $\N(k,\ldots,k,2)$ is $2^{\Omega(\n\log\n)}$.
\end{cor}

From \corref{matchings}, we can derive a lower-bound on the number of
crossing-free spanning trees of the $k\times\cdots\times k\times 2$ grid:
\begin{cor}\corlabel{spanning-trees}
  For all $d\ge 4$ and $\n=2k^{d-1}$.  The number of crossing-free trees with
  vertex set $\N(k,\ldots,k,2)$ is $2^{\Omega(\n\log\n)}$.
\end{cor}

\begin{proof}
  Each of the crossing-free matchings counted by \corref{matchings} uses
  only edges $uw$ of $G_\n$ such that $u_d=1$ and $w_d=2$.  Each such
  matching, $M$, can be augmented into a crossing-free connected graph,
  $G_M$, with vertex set $\N(k,\ldots,k,2)$ by, for example, adding all
  edges in the set
  \[
     \{ uw :\mbox{$u,w\in \N(k,\ldots,k,2)$, $u_d=w_d$ and $\|u-w\|=1$} \} \enspace .  
  \] 
  (The edges in the preceding set are those of two finite
  $(d-1)$-dimensional lattices, one in the subspace $\{x\in\R^d: x_d=1\}$
  and the other in the subspace $\{x\in\R^d: x_d=2\}$.)  The graph $G_M$
  can be reduced to a tree, $T_M$, that includes all edges
  of $M$ by repeatedly finding a cycle, $C$, and removing any edge of $C$
  that is not part of $M$.  (An edge of $C\setminus M$ exists because $M$
  is a matching, and hence acyclic.)  After each such modification, $G_M$
  remains connected and has fewer cycles.  This processes terminates
  when $G_M$ becomes the desired tree $T_M$.

  Thus, for each of the $2^{\Omega(\n\log\n)}$ matchings, $M$, there
  exists a spanning tree $T_M$ that contains $M$.  Any spanning tree
  with $\n$ vertices contains no more than $2^{\n-1}$ matchings and therefore,
  there are at least $2^{\Omega(\n\log\n)}/2^{\n-1}\in 2^{\Omega(\n\log\n)}$
  crossing-free spanning trees with vertex set $\N(k,\ldots,k,2)$.
\end{proof}

We finish this section by observing that our lower bounds are not
just for ``flat'' grids like the $k\times\cdots\times k\times 2$ grid.
They also hold for the ``square'' $k\times\cdots\times k$ grid.

\begin{cor}
  For all $d\ge 4$ and $\n=k^d$, the number of crossing-free matchings
  and spanning trees with vertex set $\N(k,\ldots,k)$ is
  $2^{\Omega(\n\log \n)}$
\end{cor}

\begin{proof}
  Observe that the $k\times\cdots\times k$ grid is made up of $k$ layers,
  each of which is a $k\times\cdots\times k\times1$ grid. Between any
  consecutive pair of these layers there are, by \corref{matchings},
  $2^{\Omega(k^{d-1}\log k)}$ crossing-free matchings that contain only
  edges that span both layers.  Since there are $k-1$ consecutive pairs
  of layers, there are therefore
  \[
     \left(2^{\Omega(k^{d-1}\log k)}\right)^{k-1} = 2^{\Omega(k^d\log k)} 
        = 2^{\Omega(\n\log\n)}
  \]
  crossing-frees graphs whose vertex set is the $k\times\cdots\times k$ grid.

  Note that the graphs we obtain in the preceding manner contain no
  cycles.  Therefore, to obtain a lower-bound of $2^{\Omega(\n\log
  \n)}$ on the number of spanning trees we can augment any of these
  graphs into a crossing-free spanning tree as is done in the proof of
  \corref{spanning-trees}.

  To obtain a lower-bound on the number of matchings we can simply count
  the matchings that only include edges from layer $i$ to layer $i+1$
  with $i\equiv 1\pmod 2$.  There are
  \[
     \left(2^{\Omega(k^{d-1}\log k)}\right)^{\lfloor (k-1)/2\rfloor} 
       = 2^{\Omega(k^d\log k)}
       = 2^{\Omega(\n\log\n)}
  \]
  such matchings.
\end{proof}


\section{Summary and Remarks}
\seclabel{summary}

We have given matching upper and lower bounds on the minimum number of
crossings in $d$-D geometric grid graphs with $m$ edges and volume at
most $\n$.  The upper-bound $\crs_d(\n,m)\in O(m^2/\n)$, for $d\ge 4$,
allows the application of a recursive counting technique to show the
lower-bound $\ncs_d(\n)\in 2^{\Omega(\n\log\n)}$; this is similar to
way in which Ajtai \etal\ \cite{ajtai.chvatal.ea:crossing-free} used the
lower-bound $\crs(n,m)\in\Omega(m^3/n^2)$ to show that that the maximum
number of planar graphs that can be drawn on any point set of size $n$
is $2^{O(n)}$.  This $2^{\Omega(\n\log\n)}$ lower-bound also holds if
we restrict the graphs to be spanning trees or matchings, but we know
very little about spanning cycles:

\begin{op}
  Determine the maximum number of crossing-free spanning cycles whose
  vertex set is a grid of volume $\n$.
\end{op}

%Unfortunately, the tight bound $\crs_3(\n,m)\in \Theta((m^2/\n)\log
%(m/\n))$ does not allow for the application of a recursive counting
%technique to determine any non-trivial bound on $\ncs_3(\n)$.  If the
%upper-bound were slightly stronger, say
%\[
%   \crs_3(\n,m)\in O((m^2/\n)\log^{1-\varepsilon}(m/\n)) \enspace ,
%\]
%then this would be sufficient to prove that
%$\ncs_3(\n)\in2^{\Omega(\n\log^{\varepsilon}\n)}$.  In contrast, if the
%lower-bound were slightly stronger, say
%\[
%  \crs_3(\n,m)\in \Omega((m^2/\n)\log^{1+\varepsilon}(m/\n)) \enspace ,
%\]
%then this would be sufficient to prove that
%$\ncs_3(\n)\in2^{O(\n\log^{1-\varepsilon}\n)}$.

The natural open problem left in this area is that of finding tight bounds
on $\ncs_3(\n)$.  A lower bound of $2^{\Omega(n)}$ follows immediately
from the fact that there exists a non-crossing 3-D grid graph with
volume $\n$ and $\Omega(N)$ edges (so this graph has $2^{\Omega(n)}$
non-crossing subgraphs).  An upper bound of $2^{O(\n\log\n)}$ can be
obtained using the argument given at the beginning of \secref{counting}.

\begin{op}\oplabel{non-trivial}
  Find non-trivial bounds---$2^{o(\n\log\n)}$ or $2^{\omega(\n)}$---on
  $\ncs_3(\n)$.
\end{op}

\opref{non-trivial}, which was the original motivation for the current
work, was communicated to the first author by David~R.~Wood and
his motivation for asking this question comes from a question of Pach
\etal~\cite{pach.thiele.ea:three-dimensional}, who ask ``Does every graph
with $n$ vertices and maximum degree three have a crossing-free 3-D grid
drawing of volume $O(n)$?''  This question remains unresolved, even when
the maximum degree three condition is relaxed to maximum degree $O(1)$.

If \opref{non-trivial} can be answered with a  non-trivial
upper bound, then this would settle Pach \etal's question
as follows.  The number of labelled graphs with $n$
vertices and having maximum degree $3$ is $2^{(3/2)n\log n -
O(n)}$~\cite[Appendix~A]{barat.matousek.ea:bounded-degree}. On the other
hand, if one can show that $\ncs_3(\n)\in 2^{o(\n\log\n)}$, then for
every constant $c>0$,
\[
   n!\ncs_3(cn) = n!2^{o(n\log n)} \le 2^{n\log n + o(n\log n)}
   < 2^{(3/2)n\log n - O(n)} \enspace ,
\]
for sufficiently large $n$. This would answer Pach \etal's question
in the negative, since there would be more labelled $n$-vertex graphs of
maximum degree three than there are labelled 3-D geometric grid
graphs of volume $cn$ for any constant $c$.   This type of counting
argument has been used successfully to answer similar questions
about geometric thickness \cite{barat.matousek.ea:bounded-degree},
distinct distances \cite{carmi.dujmovic.ea:distinct}, slope number
\cite{pach.palvolgyi:bounded}, book thickness \cite{malitz:graphs},
and queue number \cite{malitz:graphs,wood:bounded}.

Another approach to resolving the question of Pach \etal\ is to consider
that there are maximum degree 3 graphs that have some properties that
would seem to rule out a linear volume embedding.  An obvious candidate
property is that of being an \emph{expander}: There exist graphs, $G$,
with maximum degree $O(1)$ and such that, for any subset $S\subseteq
V(G)$, $|S|\le n/2$ the number of vertices of $V(G)\setminus S$ adjacent
to at least one vertex in $S$ is at least $\epsilon|S|$, for some constant
$\epsilon > 0$.

Expanders have no separator of size $o(n)$ and are therefore
non-planar~\cite{lipton.tarjan:separator}.  However, very recently
Bourgain and Yehudayoff~\cite{bourgain.yehudayoff:monotone} have
shown that there exist bounded degree graphs that are expanders and
that have constant \emph{queue number}. Through a result of Dujmovi\'c
\etal~\cite[Theorem~8]{dujmovic.por.ea:track}, this implies that there
are constant degree expanders that can be drawn on a 3-dimensional grid
with volume $O(n)$. Thus, the property of expansion is not sufficient
to rule out linear volume 3-D grid drawings.  We are still no closer
to solving Pach \etal's 14 year old problem:

\begin{op}[Pach \etal\ 1999]
  Does every graph with $n$ vertices and maximum degree three have a
  crossing-free 3-D grid drawing of volume $O(n)$?
\end{op}


\section*{Acknowledgements}

This research was initiated at the AMS Mathematics Research Communities
Workshop on Discrete and Computational Geometry, June 10--16, 2012.
The work of Vida~Dujmovi\'c and Pat Morin was partly funded by NSERC.
Adam Sheffer was partially supported by Grant 338/09 from the Israel
Science Fund and by the Israeli Centers of Research Excellence program
(Center No.~4/11).

%\bibliographystyle{plainurl}
%\bibliography{3dcrossings}


\begin{thebibliography}{10}

\bibitem{ackerman:on}
E.~Ackerman.
\newblock On topological graphs with at most four crossings per edge.
\newblock Manuscript, 2013.

\bibitem{aigner.ziegler:proofs}
M.~Aigner and G.~M. Ziegler.
\newblock {\em Proofs from THE BOOK}.
\newblock Springer, 1999.

\bibitem{ajtai.chvatal.ea:crossing-free}
M.~Ajtai, V.~Chv\'atal, M.~M. Newborn, and E.~Szemer\'edi.
\newblock Crossing-free subgraphs.
\newblock {\em Annals of Discrete Mathematics}, 12:9--12, 1982.

\bibitem{barat.matousek.ea:bounded-degree}
J.~B\'arat, J.~Matou{\v{s}}ek, and D.~R. Wood.
\newblock Bounded-degree graphs have arbitrarily large geometric thickness.
\newblock {\em Electronic Journal of Combinatorics}, 13:R3:1--14, 2006.

\bibitem{bose.czyzowicz.ea:maximum}
P.~Bose, J.~Czyzowicz, P.~Morin, and D.~R. Wood.
\newblock The maximum number of edges in a three-dimensional grid-drawing.
\newblock {\em Journal of Graph Algorithms and Applications}, 8(1):21--26,
  2004.

\bibitem{bourgain.yehudayoff:monotone}
J.~Bourgain and A.~Yehudayoff.
\newblock Monotone expansion.
\newblock In {\em Proceedings of the 44th Symposium on Theory of Computing},
  pages 1061--1078. ACM, 2012.

\bibitem{bukh.hubard:space}
B.~Bukh and A.~Hubard.
\newblock Space crossing numbers.
\newblock {\em Combinatorics, Probability and Computing}, 21(3):358--373, 2012.

\bibitem{carmi.dujmovic.ea:distinct}
P.~Carmi, V.~Dujmovi\'c, P.~Morin, and D.~R. Wood.
\newblock Distinct distances in graph drawings.
\newblock {\em Electronic Journal of Combinatorics}, 15:R107:1--23, 2008.

\bibitem{cohen.eades.ea:three-dimensional}
R.~F. Cohen, P.~Eades, T.~Lin, and F.~Ruskey.
\newblock Three-dimensional graph drawing.
\newblock {\em Algorithmica}, 17(2):199--208, 1996.

\bibitem{dey:improved}
T.~K. Dey.
\newblock Improved bounds on planar $k$-sets and related problems.
\newblock {\em Discrete {\&} Computational Geometry}, 19:373--382, 1998.

\bibitem{battista.frati.ea:on}
G.~Di~Battista, F.~Frati, and J.~Pach.
\newblock On the queue number of planar graphs.
\newblock In {\em Proceedings of the 51st Annual IEEE Symposium on Foundations
  of Computer Science (FOCS2010)}, pages 365 --374, 2010.

\bibitem{dujmovic.morin.ea:layout}
V.~Dujmovi{\'c}, P.~Morin, and D.~R. Wood.
\newblock Layout of graphs with bounded tree-width.
\newblock {\em SIAM Journal on Computing}, 34(3):553--579, 2005.

\bibitem{dujmovic.por.ea:track}
V.~Dujmovi{\'c}, A.~P\'or, and D.~R. Wood.
\newblock Track layouts of graphs,.
\newblock {\em Discrete Mathematics and Theoretical Computer Science},
  6(2):497--522, 2004.

\bibitem{dujmovic.wood:three-dimensional}
V.~Dujmovi{\'c} and D.~R. Wood.
\newblock Three-dimensional grid drawings with sub-quadratic volume.
\newblock In J\'{a}nos Pach, editor, {\em Towards a Theory of Geometric
  Graphs}, volume 342 of {\em Contemporary Mathematics}, pages 55--66. AMS,
  2004.

\bibitem{dujmovic.wood:upward}
V.~Dujmovi{\'c} and D.~R. Wood.
\newblock Upward three-dimensional grid drawings of graphs.
\newblock {\em Order}, 23(1):1--20, 2006.

\bibitem{felsner.liotta.ea:straight-line}
S.~Felsner, G.~Liotta, and S.~Wismath.
\newblock Straight-line drawings on restricted integer grids in two and three
  dimensions.
\newblock {\em Journal of Graph Algorithms and Applications}, 7(4):363--398,
  2003.

\bibitem{hardy.wright:introduction}
G.~H. Hardy and E.~M. Wright.
\newblock {\em An Introduction to the Theory of Numbers}.
\newblock Oxford Science Publications. Oxford University Press, 1979.

\bibitem{hoffmann.sharir.ea:counting}
M.~Hoffmann, M.~Sharir, A.~Sheffer, C.~D. T{\'o}th, and E.~Welzl.
\newblock Counting plane graphs: Flippability and its applications.
\newblock In Frank Dehne, John Iacono, and J{\"o}rg-R{\"u}diger Sack, editors,
  {\em Proceedings of the 12th Symposium on Algorithms and Data Structures
  (WADS~2011)}, volume 6844 of {\em Lecture Notes in Computer Science}, pages
  524--535. Springer, 2011.

\bibitem{lipton.tarjan:separator}
R.~J. Lipton and R.~E. Tarjan.
\newblock A separator theorem for planar graphs.
\newblock {\em SIAM Journal on Applied Mathematics}, 36:177--189, 1979.

\bibitem{malitz:graphs}
S.~M. Malitz.
\newblock Graphs with {$E$} edges have pagenumber {$O(\sqrt{E})$}.
\newblock {\em Journal of Algorithms}, 17(1):71--84, 1994.

\bibitem{pach.palvolgyi:bounded}
J.~Pach and D.~P\'alv\"olgyi.
\newblock Bounded-degree graphs can have arbitrarily large slope numbers.
\newblock {\em Electronic Journal of Combinatorics}, 13:N1:1--4, 2006.

\bibitem{pach.radoicic.ea:improving}
J.~Pach, R.~Radoi\v{c}i{\'c}, G.~Tardos, and G.~T{\'o}th.
\newblock Improving the crossing lemma by finding more crossings in sparse
  graphs.
\newblock {\em Discrete {\&} Computational Geometry}, 36(4):527--552, 2006.

\bibitem{pach.thiele.ea:three-dimensional}
J.~Pach, T.~Thiele, and G.~T\'{o}th.
\newblock Three-dimensional grid drawings of graphs.
\newblock In Bernard Chazelle, Jacob~E. Goodman, and Richard Pollack, editors,
  {\em Advances in discrete and computational geometry}, volume 223 of {\em
  Contemporary Mathematics}, pages 251--255. AMS, 1999.

\bibitem{sharir.sheffer:counting}
M.~Sharir and A.~Sheffer.
\newblock Counting triangulations of planar point sets.
\newblock {\em Electronic Journal of Combinatorics}, 18(1):P70:1--74, 2011.

\bibitem{sharir.sheffer:counting*1}
M.~Sharir and A.~Sheffer.
\newblock Counting plane graphs: Cross-graph charging schemes.
\newblock {\em Combinatorics, Probability and Computing}, 22(6):935--954, 2013.

\bibitem{sharir.sheffer.ea:counting}
M.~Sharir, A.~Sheffer, and E.~Welzl.
\newblock Counting plane graphs: perfect matchings, spanning cycles, and
  {K}asteleyn's technique.
\newblock {\em Journal of Combinatorial Theory, Series A}, 120:777--794, 2013.

\bibitem{sharir.welzl:on}
M.~Sharir and E.~Welzl.
\newblock On the number of crossing-free matchings, cycles, and partitions.
\newblock {\em SIAM Journal on Computing}, 36(3):695--720, 2006.

\bibitem{sheffer:numbers}
A.~Sheffer.
\newblock Numbers of plane graphs.
\newblock Available from:
  \url{http://www.cs.tau.ac.il/~sheffera/counting/PlaneGraphs.html} [cited
  2012-12-10].

\bibitem{szekely:crossing}
L.~A. Sz{\'e}kely.
\newblock Crossing numbers and hard {E}rd{\"o}s problems in discrete geometry.
\newblock {\em Combinatorics, Probability and Computing}, 6(3):353--358, 1997.

\bibitem{szemeredi.trotter:extremal}
E.~Szemer{\'e}di and W.~Trotter.
\newblock Extremal problems in discrete geometry.
\newblock {\em Combinatorica}, 3:381--392, 1983.

\bibitem{wood:bounded}
David~R. Wood.
\newblock Bounded-degree graphs have arbitrarily large queue-number.
\newblock {\em Discrete Mathematics {\&} Theoretical Computer Science},
  10(1):27--34, 2008.

\end{thebibliography}

\appendix
\section{Proof of \clmref{nummer}}
\applabel{nummer}


\begin{proof}[Proof of \clmref{nummer}]
  We must prove that $\sum_{i=1}^k\phi(i)^2 \in \Omega(\log k)$.
  Recall the following result on Euler's totient
  function \cite[Theorem~330]{hardy.wright:introduction}:
  \[
     (3/\pi^2)n^2 - O(n) \le \sum_{i=1}^n \varphi(i) \le (3/\pi^2)n^2 + O(n\log n) \enspace .\footnote{Hardy and Wright state the result as
   $\sum_{i=1}^n \varphi(i) = (3/\pi^2)n^2 + O(n\log n)$. However,
   in their notation $f(n)=O(g(n))$ means $|f(n)|\le c g(n)$ for some constant $c>0$.  This leads to the statement given here.}
  \]
  Using this result and the Cauchy-Schwartz Inequality, we obtain
  \[
    (3/\pi^2)n^2 - O(n) \le \sum_{i=1}^n \varphi(i) 
     = \sum_{i=1}^n\varphi(i)\cdot 1 \le \sqrt{\sum_{i=1}^n \varphi(i)^2}\cdot\sqrt{\sum_{i=1}^n 1}
     = \sqrt{\sum_{i=1}^n \varphi(i)^2}\cdot\sqrt{n} \enspace .
  \]
  Dividing by $\sqrt{n}$ and squaring, we obtain
  \begin{equation}
    \sum_{i=1}^n \varphi(i)^2 \ge (9/\pi^4)n^3 - O(n^2) + O(n) \ge (9/\pi^4)n^3 \ge n^3/11 \enspace , \eqlabel{chimp}
  \end{equation}
  for all $n\ge N_0$, for some sufficiently large $N_0$.
  On the other hand, $\varphi(i) < i$, so
  \begin{equation}
    \sum_{i=1}^n \varphi(i)^2 
         < \sum_{i=1}^n i^2\le \sum_{i=1}^n n^2 = n^3 \enspace . \eqlabel{chomp}
  \end{equation}
  We can now prove the claim 
  as follows:
  \begin{align*}
    \sum_{i=1}^k \varphi(i)^2/i^3 
      &\ge \sum_{i=N_0}^k \varphi(i)^2/i^3  \\
      &\ge \sum_{j=N_0}^{\lfloor\log_3 k\rfloor}
             \sum_{i=3^{j-1}+1}^{3^j} \varphi(i)^2/i^3  \\
      &\ge \sum_{j=N_0}^{\lfloor\log_3 k\rfloor}\frac{1}{3^{3j}}
             \left(\sum_{i=3^{j-1}+1}^{3^j} \varphi(i)^2\right)  \\
      &= \sum_{j=N_0}^{\lfloor\log_3 k\rfloor}\frac{1}{3^{3j}}
             \left(\sum_{i=1}^{3^j}\varphi(i)^2-\sum_{i=1}^{3^{j-1}} \varphi(i)^2\right)  \\
      &\ge \sum_{j=N_0}^{\lfloor\log_3 k\rfloor}\frac{1}{3^{3j}}
             \left(3^{3j}/11 - (3^{j-1})^3\right)  
              & \text{(by using \eqref{chimp} and \eqref{chomp})} \\
      &\ge \sum_{j=N_0}^{\lfloor\log_3 k\rfloor}\frac{1}{3^{3j}}
             \left(3^{3j}/11 - 3^{3j}/27\right)  \\
      &= \sum_{j=N_0}^{\lfloor\log_3 k\rfloor} \Omega(1) = \Omega(\log k) \enspace . \qedhere
  \end{align*}
\end{proof}

\end{document}


